<template>
    <div class="player-content flex-center">
        <div class="player-video-area flex-center" v-ratio="{ratio: 1.7}">
            <div class="player-video-wrap flex-center">
                <video crossorigin="anonymous" preload="auto" :src="videoInfo ? videoInfo.videoSrc : ''" ref="playerRef"></video>
            </div>
            <div class="player-video-control" 
                @click="handleControlClick"
                @mousemove="handleControlMouseMove" 
                @mouseleave="handleControlMouseLeave" 
                ref="playerControlRef"
            >
                <transition name="player-control-fade">
                    <div class="player-control-wrap" 
                        @click="(event) => event.stopPropagation()" 
                        @mousemove="handleControlBottomMouseMove"
                        v-show="isMouseMoving"
                    >
                        <!-- 阴影 -->
                        <div class="player-control-mask"></div>
                        <!-- 进度条 -->
                        <div class="player-control-top">
                            <div class="player-process">
                                <div class="player-process-area flex-center pb-6"
                                    @click="handleProcessBarClick"
                                    @mouseenter="handleProcessBarMouseEnter"
                                    @mousemove="handleProcessBarMouseMove"
                                    @mouseleave="handleProcessBarMouseLeave"
                                    @mousedown="handleProcessBarMouseDown"
                                    @mouseup="handleProcessBarMouseUp"
                                    ref="playerProcessRef"
                                >
                                    <div class="player-process-wrap">
                                        <div class="player-process-main"></div>
                                        <div class="player-process-current" :style="{width: currentProcess + '%'}"></div>
                                        <div class="player-process-buffer" :style="{width: bufferedProcess + '%'}"></div>
                                    </div>
                                    <div class="player-process-thumb-icon" :style="{ left: currentProcess + '%', transform: `translateX(-50%)` }">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                            <!-- 定义元素 -->
                                            <defs>
                                                <clipPath id="__lottie_element_55">
                                                    <rect width="18" height="18" x="0" y="0">

                                                    </rect>
                                                </clipPath>
                                            </defs>
                                            <!-- 设置裁切路径 -->
                                            <g clip-path="url(#__lottie_element_55)">
                                                <g transform="matrix(0.9883429408073425,-0.7275781631469727,0.6775955557823181,0.920446515083313,7.3224687576293945,-0.7606706619262695)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(0.9937776327133179,-0.11138220876455307,0.11138220876455307,0.9937776327133179,-2.5239999294281006,1.3849999904632568)">
                                                        <path fill="rgb(51,51,51)" fill-opacity="1" d=" M0.75,-1.25 C0.75,-1.25 0.75,1.25 0.75,1.25 C0.75,1.663925051689148 0.4139249920845032,2 0,2 C0,2 0,2 0,2 C-0.4139249920845032,2 -0.75,1.663925051689148
                                                            -0.75,1.25 C-0.75,1.25 -0.75,-1.25 -0.75,-1.25 C-0.75,-1.663925051689148 -0.4139249920845032,-2 0,-2 C0,-2 0,-2 0,-2 C0.4139249920845032,-2 0.75,-1.663925051689148 0.75,-1.25z">
                                                        </path>
                                                    </g>
                                                </g>
                                                <g transform="matrix(1.1436611413955688,0.7535901665687561,-0.6317168474197388,0.9587040543556213,16.0070743560791,2.902894973754883)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(0.992861807346344,0.1192704513669014,-0.1192704513669014,0.992861807346344,-2.5239999294281006,1.3849999904632568)">
                                                        <path fill="rgb(51,51,51)" fill-opacity="1" d=" M0.75,-1.25 C0.75,-1.25 0.75,1.25 0.75,1.25 C0.75,1.663925051689148 0.4139249920845032,2 0,2 C0,2 0,2 0,2 C-0.4139249920845032,2 -0.75,1.663925051689148 
                                                        -0.75,1.25 C-0.75,1.25 -0.75,-1.25 -0.75,-1.25 C-0.75,-1.663925051689148 -0.4139249920845032,-2 0,-2 C0,-2 0,-2 0,-2 C0.4139249920845032,-2 0.75,-1.663925051689148 0.75,-1.25z">
                                                        </path>
                                                    </g>
                                                </g>
                                                <g transform="matrix(1,0,0,1,8.890999794006348,8.406000137329102)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(1,0,0,1,0.09099999815225601,1.1009999513626099)">
                                                        <path fill="rgb(255,255,255)" fill-opacity="1" d=" M7,-3 C7,-3 7,3 7,3 C7,4.379749774932861 5.879749774932861,5.5 4.5,5.5 C4.5,5.5 -4.5,5.5 -4.5,5.5 C-5.879749774932861,5.5 -7,4.379749774932861 
                                                            -7,3 C-7,3 -7,-3 -7,-3 C-7,-4.379749774932861 -5.879749774932861,-5.5 -4.5,-5.5 C-4.5,-5.5 4.5,-5.5 4.5,-5.5 C5.879749774932861,-5.5 7,-4.379749774932861 7,-3z">
                                                        </path>
                                                        <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(51,51,51)" stroke-opacity="1" stroke-width="1.5" d=" M7,-3 C7,-3 7,3 7,3 C7,4.379749774932861 
                                                            5.879749774932861,5.5 4.5,5.5 C4.5,5.5 -4.5,5.5 -4.5,5.5 C-5.879749774932861,5.5 -7,4.379749774932861 -7,3 C-7,3 -7,-3 -7,-3 C-7,-4.379749774932861 -5.879749774932861,-5.5 -4.5,-5.5 C-4.5,-5.5 
                                                            4.5,-5.5 4.5,-5.5 C5.879749774932861,-5.5 7,-4.379749774932861 7,-3z">
                                                        </path>
                                                    </g>
                                                </g>
                                                <g transform="matrix(1,0,0,1,8.89900016784668,8.083999633789062)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(1,0,0,1,-2.5239999294281006,1.3849999904632568)">
                                                        <path fill="rgb(51,51,51)" fill-opacity="1" d=" M0.875,-1.125 C0.875,-1.125 0.875,1.125 0.875,1.125 C0.875,1.607912540435791 0.48291251063346863,2 0,2 C0,2 0,2 0,2 C-0.48291251063346863,2 
                                                            -0.875,1.607912540435791 -0.875,1.125 C-0.875,1.125 -0.875,-1.125 -0.875,-1.125 C-0.875,-1.607912540435791 -0.48291251063346863,-2 0,-2 C0,-2 0,-2 0,-2 C0.48291251063346863,-2 0.875,-1.607912540435791 
                                                            0.875,-1.125z">
                                                        </path>
                                                    </g>
                                                </g>
                                                <g transform="matrix(1,0,0,1,14.008999824523926,8.083999633789062)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(1,0,0,1,-2.5239999294281006,1.3849999904632568)">
                                                        <path fill="rgb(51,51,51)" fill-opacity="1" d=" M0.8999999761581421,-1.100000023841858 C0.8999999761581421,-1.100000023841858 0.8999999761581421,1.100000023841858 0.8999999761581421,1.100000023841858 
                                                            C0.8999999761581421,1.596709966659546 0.4967099726200104,2 0,2 C0,2 0,2 0,2 C-0.4967099726200104,2 -0.8999999761581421,1.596709966659546 -0.8999999761581421,1.100000023841858 
                                                            C-0.8999999761581421,1.100000023841858 -0.8999999761581421,-1.100000023841858 -0.8999999761581421,-1.100000023841858 C-0.8999999761581421,-1.596709966659546 -0.4967099726200104,-2 0,-2 C0,-2 0,-2 0,-2 
                                                            C0.4967099726200104,-2 0.8999999761581421,-1.596709966659546 0.8999999761581421,-1.100000023841858z">
                                                        </path>
                                                    </g>
                                                </g>
                                            </g>
                                        </svg>
                                    </div>
                                </div>
                                <!-- 快照 -->
                                <div class="player-progress-popup" :style="{display: isShowPopup ? 'block' : 'none'}" ref="playerPopupRef" v-show="!isLoadingShotImage">
                                    <img :src="shotUrl" alt="" class="player-progress-preview-image">
                                    <div class="player-progress-preview-time"></div>
                                </div>
                            </div>
                        </div>
                        <!-- 控件区域 -->
                        <div class="player-control-bottom flex">
                            <div class="player-control-bottom-left flex-start flex-1">
                                <div class="player-ctrl-btn player-ctrl-play" v-if="!isSmallWindow" @click="handleClickCtrlBtn">
                                    <svg 
                                        v-if="!isPlaying"
                                        xmlns="http://www.w3.org/2000/svg" 
                                        viewBox="0 0 28 28" 
                                        width="28" 
                                        height="28" 
                                        preserveAspectRatio="xMidYMid meet" 
                                        style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                        <defs>
                                            <clipPath id="__lottie_element_1281">
                                                <rect width="28" height="28" x="0" y="0"></rect>
                                            </clipPath>
                                        </defs>
                                        <g clip-path="url(#__lottie_element_1281)">
                                            <g transform="matrix(0.22383984923362732,0,0,0.22383984923362732,20.641138076782227,14.097020149230957)" opacity="0.002394794788986161" style="display: none;">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,-7.984000205993652 -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 
                                                    -8.008000373840332,7.984000205993652 C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 -3.003999948501587,7.995999813079834 
                                                    -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 -2.9839999675750732,-8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" stroke-opacity="1" stroke-width="0" d=" M-5.484000205993652,-10 C-7.953000068664551,-10
                                                    -8,-7.984000205993652 -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 -8.008000373840332,7.984000205993652 C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668
                                                    -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 -3.003999948501587,7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 -2.9839999675750732,-8 
                                                    -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                </g>
                                            </g>
                                            <g transform="matrix(0.6509166955947876,0,0,0.6509166955947876,22.417274475097656,14)" 
                                                    opacity="0.002459409968898996" style="display: none;">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 
                                                    -8,-7.984000205993652 -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 -8.008000373840332,7.984000205993652 C-8.008000373840332,7.984000205993652 -7.984000205993652,
                                                    9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 -3.003999948501587,7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 -2.9839999675750732,
                                                    -8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" 
                                                        stroke="rgb(255,255,255)" stroke-opacity="1" stroke-width="0" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,-7.984000205993652 -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,
                                                        7.984000205993652 -8.008000373840332,7.984000205993652 C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 -3.003999948501587,
                                                        7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 -2.9839999675750732,-8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                </g>
                                            </g>
                                            <g style="display: block;" transform="matrix(1,0,0,1,14,14)" opacity="1">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d="M0 0"></path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" stroke-opacity="1" stroke-width="0" d="M0 0"></path>
                                                </g>
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-7.031000137329102,-10.875 C-7.031000137329102,-10.875 -8.32800006866455,-11.25 -9.42199993133545,-10.468999862670898 
                                                    C-10.109999656677246,-9.906999588012695 -10,-7.992000102996826 -10,-7.992000102996826 C-10,-7.992000102996826 -10,8.015999794006348 -10,8.015999794006348 C-10,8.015999794006348 -10.125,10.241999626159668 
                                                    -9,10.991999626159668 C-7.875,11.741999626159668 -5,10.031000137329102 -5,10.031000137329102 C-5,10.031000137329102 7.968999862670898,1.875 7.968999862670898,1.875 C7.968999862670898,1.875 9,1.062000036239624 9,
                                                    0 C9,-1.062000036239624 7.968999862670898,-1.937999963760376 7.968999862670898,-1.937999963760376 C7.968999862670898,-1.937999963760376 -7.031000137329102,-10.875 -7.031000137329102,-10.875z"></path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" stroke-opacity="1" stroke-width="0" d=" M-7.031000137329102,-10.875 C-7.031000137329102,-10.875 
                                                    -8.32800006866455,-11.25 -9.42199993133545,-10.468999862670898 C-10.109999656677246,-9.906999588012695 -10,-7.992000102996826 -10,-7.992000102996826 C-10,-7.992000102996826 -10,8.015999794006348 -10,8.015999794006348 
                                                    C-10,8.015999794006348 -10.125,10.241999626159668 -9,10.991999626159668 C-7.875,11.741999626159668 -5,10.031000137329102 -5,10.031000137329102 C-5,10.031000137329102 7.968999862670898,1.875 7.968999862670898,1.875 
                                                    C7.968999862670898,1.875 9,1.062000036239624 9,0 C9,-1.062000036239624 7.968999862670898,-1.937999963760376 7.968999862670898,-1.937999963760376 C7.968999862670898,-1.937999963760376 -7.031000137329102,-10.875 
                                                    -7.031000137329102,-10.875z">
                                                    </path>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                    <svg v-else xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" preserveAspectRatio="xMidYMid meet" 
                                    style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                        <defs>
                                            <clipPath id="__lottie_element_403">
                                                <rect width="28" height="28" x="0" y="0">
                                                </rect>
                                            </clipPath>
                                        </defs>
                                        <g clip-path="url(#__lottie_element_403)">
                                            <g transform="matrix(1,0,0,1,14,14)" opacity="1" style="display: block;">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,-7.984000205993652 
                                                        -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 -8.008000373840332,7.984000205993652 
                                                        C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,
                                                        9.991999626159668 -3.003999948501587,7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,
                                                        7.995999813079834 -2.9839999675750732,-8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,
                                                        -10 -5.484000205993652,-10z">
                                                    </path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" 
                                                        stroke-opacity="1" stroke-width="0" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,-7.984000205993652 -8,
                                                        -7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 -8.008000373840332,7.984000205993652 
                                                        C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,
                                                        9.991999626159668 -3.003999948501587,7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,
                                                        7.995999813079834 -2.9839999675750732,-8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,
                                                        -10 -5.484000205993652,-10z">
                                                    </path>
                                                </g>
                                            </g>
                                            <g transform="matrix(0.9999996423721313,0,0,0.9999996423721313,
                                                24.812000274658203,14)" opacity="1" style="display: block;">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,
                                                        -7.984000205993652 -8,-7.984000205993652 C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 
                                                        -8.008000373840332,7.984000205993652 C-8.008000373840332,7.984000205993652 -7.984000205993652,9.991999626159668 
                                                        -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 -3.003999948501587,7.995999813079834 
                                                        -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 -2.9839999675750732,-8 -2.9839999675750732,
                                                        -8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                    <path stroke-linecap="butt" 
                                                        stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" stroke-opacity="1" 
                                                        stroke-width="0" d=" M-5.484000205993652,-10 C-7.953000068664551,-10 -8,-7.984000205993652 -8,-7.984000205993652 
                                                        C-8,-7.984000205993652 -8.008000373840332,7.984000205993652 -8.008000373840332,7.984000205993652 C-8.008000373840332,
                                                        7.984000205993652 -7.984000205993652,9.991999626159668 -5.5,9.991999626159668 C-3.0160000324249268,9.991999626159668 
                                                        -3.003999948501587,7.995999813079834 -3.003999948501587,7.995999813079834 C-3.003999948501587,7.995999813079834 
                                                        -2.9839999675750732,-8 -2.9839999675750732,-8 C-2.9839999675750732,-8 -3.015000104904175,-10 -5.484000205993652,-10z">
                                                    </path>
                                                </g>
                                            </g>
                                            <g transform="matrix(1,0,0,1,4.000003814697266,14)" opacity="0.0000019383089441760147" style="display: block;">
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d="M0 0">
                                                    </path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(255,255,255)" 
                                                        stroke-opacity="1" stroke-width="0" d="M0 0">
                                                    </path>
                                                </g>
                                                <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                    <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-7.031000137329102,-10.875 C-7.031000137329102,-10.875
                                                        -8.32800006866455,-11.25 -9.42199993133545,-10.468999862670898 C-10.109999656677246,-9.906999588012695 -10,
                                                        -7.992000102996826 -10,-7.992000102996826 C-10,-7.992000102996826 -10,8.015999794006348 -10,8.015999794006348 
                                                        C-10,8.015999794006348 -10.125,10.241999626159668 -9,10.991999626159668 C-7.875,11.741999626159668 -5,
                                                        10.031000137329102 -5,10.031000137329102 C-5,10.031000137329102 7.968999862670898,1.875 7.968999862670898,1.875 
                                                        C7.968999862670898,1.875 9,1.062000036239624 9,0 C9,-1.062000036239624 7.968999862670898,-1.937999963760376 
                                                        7.968999862670898,-1.937999963760376 C7.968999862670898,-1.937999963760376 -7.031000137329102,-10.875 
                                                        -7.031000137329102,-10.875z">
                                                    </path>
                                                    <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" 
                                                        stroke-miterlimit="4" stroke="rgb(255,255,255)" stroke-opacity="1" stroke-width="0" d=" M-7.031000137329102,
                                                        -10.875 C-7.031000137329102,-10.875 -8.32800006866455,-11.25 -9.42199993133545,-10.468999862670898 
                                                        C-10.109999656677246,-9.906999588012695 -10,-7.992000102996826 -10,-7.992000102996826 C-10,-7.992000102996826 -10,
                                                        8.015999794006348 -10,8.015999794006348 C-10,8.015999794006348 -10.125,10.241999626159668 -9,10.991999626159668
                                                        C-7.875,11.741999626159668 -5,10.031000137329102 -5,10.031000137329102 C-5,10.031000137329102 7.968999862670898,
                                                        1.875 7.968999862670898,1.875 C7.968999862670898,1.875 9,1.062000036239624 9,0 C9,-1.062000036239624 
                                                        7.968999862670898,-1.937999963760376 7.968999862670898,-1.937999963760376 C7.968999862670898,-1.937999963760376 
                                                        -7.031000137329102,-10.875 -7.031000137329102,-10.875z">
                                                    </path>
                                                </g>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                                <div class="player-ctrl-time flex-start text-[12px] mr-20">
                                    <div class="player-ctrl-time-current player-ctrl-time-label text-center">{{ currentProcessTime }}</div>
                                    <div class="player-ctrl-time-divide pl-5 pr-5">/</div>
                                    <div class="player-ctrl-time-duration player-ctrl-time-label text-center">{{ totalProcessTime }}</div>
                                </div>
                                <div class="player-danmaku-area flex-start">
                                    <div class="player-danmaku-switch mr-18" @click="handleClickDanmakuSwitchBtn">
                                        <svg xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24"  v-if="!isDanmakuClosed">
                                            <path fill-rule="evenodd" d="M11.989 4.828c-.47 0-.975.004-1.515.012l-1.71-2.566a1.008 1.008 0 0 0-1.678 1.118l.999 
                                                1.5c-.681.018-1.403.04-2.164.068a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 4.185 0 1.965.115 3.67.35 5.116a4.012 
                                                4.012 0 0 0 3.763 3.363l.906.046c1.205.063 1.808.095 3.607.095a.988.988 0 0 0 
                                                0-1.975c-1.758 0-2.339-.03-3.501-.092l-.915-.047a2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 
                                                0-1.563.076-2.864.225-3.904.14-.977.96-1.713 1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 
                                                1.71.81 1.855 1.814.075.524.113 1.962.141 3.065v.002c.01.342.017.65.025.88a.987.987 0 1 0 
                                                1.974-.068c-.008-.226-.016-.523-.025-.856v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.9-.032-1.743-.058-2.531-.078l1.05-1.46a1.008 1.008 
                                                0 0 0-1.638-1.177l-1.862 2.59c-.38-.004-.744-.007-1.088-.007h-.13Zm.521 4.775h-1.32v4.631h2.222v.847h-2.618v1.078h2.618l.003.678c.36.026.714.163 
                                                1.01.407h.11v-1.085h2.694v-1.078h-2.695v-.847H16.8v-4.63h-1.276a8.59 8.59 0 0 0 .748-1.42L15.183 7.8a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 
                                                0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Zm-4.18 3.564.154-1.485h1.98V8.294h-3.2v.98H9.33v1.43H7.472l-.308 3.453h2.277c0 1.166-.044 
                                                1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 1.067.062.005c.285.02.551.04.818.04 1.001-.067 
                                                1.562-.419 1.694-1.057.11-.638.176-1.903.176-3.795h-2.2Zm7.458.11v-.858h-1.254v.858h1.254Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902h1.254v.902h-1.254Z" 
                                                clip-rule="evenodd">
                                            </path>
                                            <path fill="#FF6699" fill-rule="evenodd" d="M22.846 14.627a1 1 0 0 0-1.412.075l-5.091 5.703-2.216-2.275-.097-.086-.008-.005a1 1 0 0 
                                                0-1.322 1.493l2.963 3.041.093.083.007.005c.407.315 1 .27 1.354-.124l5.81-6.505.08-.102.005-.008a1 1 0 0 0-.166-1.295Z" 
                                                clip-rule="evenodd">
                                            </path>
                                        </svg>
                                        <svg xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" v-if="isDanmakuClosed">
                                            <path 
                                                fill-rule="evenodd" 
                                                clip-rule="evenodd" 
                                                d="m8.085 4.891-.999-1.499a1.008 1.008 0 0 1 1.679-1.118l1.709 2.566c.54-.008 1.045-.012 1.515-.012h.13c.345 0 .707.003 1.088.007l1.862-2.59a1.008 1.008 0 0 1 1.637 1.177l-1.049 1.46c.788.02 1.631.046 2.53.078 
                                                1.958.069 3.468 1.6 3.74 3.507.088.613.13 2.158.16 3.276l.001.027c.01.333.017.63.025.856a.987.987 0 0 
                                                1-1.974.069c-.008-.23-.016-.539-.025-.881v-.002c-.028-1.103-.066-2.541-.142-3.065-.143-1.004-.895-1.78-1.854-1.813-2.444-.087-4.466-.13-6.064-.131-1.598 0-3.619.044-6.063.13a2.037 2.037 0 0 0-1.945 1.748c-.15 
                                                1.04-.225 2.341-.225 3.904 0 1.874.11 3.474.325 4.798.154.949.95 1.66 1.91 1.708a97.58 97.58 0 0 0 5.416.139.988.988 0 0 1 0 1.975c-2.196 0-3.61-.047-5.513-.141A4.012 4.012 0 0 1 2.197 
                                                17.7c-.236-1.446-.351-3.151-.351-5.116 0-1.64.08-3.035.245-4.184A4.013 4.013 0 0 1 5.92 4.96c.761-.027 1.483-.05 2.164-.069Z"
                                            />
                                            <path 
                                                d="m12.521 9.598h-1.32v4.63h2.222v.848h-2.618v1.078h2.431a5.01 5.01 0 0 1 3.575-3.115V9.598h-1.276a8.59 8.59 0 0 0 .748-1.42l-1.089-.384a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 
                                                0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Z"
                                            />
                                            <path 
                                                d="m8.341 12.962.154-1.485h1.98V8.289h-3.2v.979h2.067v1.43H7.483l-.308 3.454h2.277c0 1.166-.044 1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 
                                                1.067.062.004c.285.02.551.04.818.04 1.001-.066 1.562-.418 1.694-1.056.11-.638.176-1.903.176-3.795h-2.2Z"
                                            />
                                            <path 
                                                d="m15.8 11.218v-.858h-1.254v.858H15.8Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902H15.8v.902h-1.254Z"
                                            />
                                            <path 
                                                d="m19.337 21.458a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm-.002-1.502a2.5 2.5 0 0 1-2.217-3.657l3.326 3.398a2.49 2.49 0 0 1-1.109.259Zm2.5-2.5c0 .42-.103.815-.286 1.162l-3.328-3.401a2.5 2.5 0 0 1 3.614 2.239Z"
                                            />
                                        </svg>
                                    </div>
                                    <div class="player-danmaku-setting mr-18" v-if="!isSmallWindow">
                                        <svg xmlns="http://www.w3.org/2000/svg" @click="handleClickDanmakuSettingBtn" data-pointer="none" viewBox="0 0 24 24">
                                            <path fill-rule="evenodd" d="m15.645 4.881 
                                                1.06-1.473a.998.998 0 1 0-1.622-1.166L13.22 4.835a110.67 110.67 0 0 0-1.1-.007h-.131c-.47 0-.975.004-1.515.012L8.783 
                                                2.3A.998.998 0 0 0 7.12 3.408l.988 1.484c-.688.019-1.418.042-2.188.069a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 
                                                4.185 0 1.965.115 3.67.35 5.116a4.012 4.012 0 0 0 3.763 3.363c1.903.094 3.317.141 5.513.141a.988.988 0 0 0 0-1.975 97.58 97.58 
                                                0 0 1-5.416-.139 2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 0-1.563.076-2.864.225-3.904.14-.977.96-1.713 
                                                1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 1.71.81 1.855 1.814.075.524.113 1.962.141 
                                                3.065v.002c.005.183.01.07.014-.038.004-.096.008-.189.011-.081a.987.987 0 1 0 1.974-.069c-.004-.105-.007-.009-.011.09-.002.056-.004.112-.007.135l-.002.01a.574.574 
                                                0 0 1-.005-.091v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.905-.032-1.752-.058-2.543-.079Zm-3.113 4.703h-1.307v4.643h2.2v.04l.651-1.234c.113-.215.281-.389.482-.509v-.11h.235c.137-.049.283-.074.433-.074h1.553V9.584h-1.264a8.5 
                                                8.5 0 0 0 .741-1.405l-1.078-.381c-.24.631-.501 1.23-.806 1.786h-1.503l.686-.305c-.228-.501-.5-.959-.806-1.394l-1.034.348c.294.392.566.839.817 1.35Zm-1.7 
                                                5.502h2.16l-.564 1.068h-1.595v-1.068Zm-2.498-1.863.152-1.561h1.96V8.289H7.277v.969h2.048v1.435h-1.84l-.306 3.51h2.254c0 1.155-.043 1.906-.12 
                                                2.255-.076.348-.38.523-.925.523-.305 0-.61-.022-.893-.055l.294 1.056.061.005c.282.02.546.039.81.039.991-.065 1.547-.414 1.677-1.046.11-.631.175-1.883.175-3.757H8.334Zm5.09-.8v.85h-1.188v-.85h1.187Zm-1.188-.955h1.187v-.893h-1.187v.893Zm2.322.007v-.893h1.241v.893h-1.241Zm.528 
                                                2.757a1.26 1.26 0 0 1 1.087-.627l4.003-.009a1.26 1.26 0 0 1 1.094.63l1.721 2.982c.226.39.225.872-.001 1.263l-1.743 3a1.26 1.26 0 0 1-1.086.628l-4.003.009a1.26 
                                                1.26 0 0 1-1.094-.63l-1.722-2.982a1.26 1.26 0 0 1 .002-1.263l1.742-3Zm1.967.858a1.26 1.26 0 0 0-1.08.614l-.903 1.513a1.26 1.26 0 0 0-.002 1.289l.885 1.492c.227.384.64.62 
                                                1.086.618l2.192-.005a1.26 1.26 0 0 0 1.08-.615l.904-1.518a1.26 1.26 0 0 0 .001-1.288l-.884-1.489a1.26 1.26 0 0 0-1.086-.616l-2.193.005Zm2.517 2.76a1.4 1.4 0 1 1-2.8 0 1.4
                                                1.4 0 0 1 2.8 0Z" clip-rule="evenodd">
                                            </path>
                                        </svg>
                                        <!-- 弹幕设置弹出框 -->
                                        <transition name="opacity-fade">
                                            <div class="setting-wrap" v-if="isShowSetting">
                                                <div class="setting-show-wrap">
                                                    <span class="text-[12px] mr-5">显示区域</span>
                                                        <div class="setting-show-area" :style="{'--showArea': `${danmakuShowArea}%`}">
                                                            <div class="setting-show-empty"></div>
                                                            <div class="setting-show-fill"></div>
                                                            <input 
                                                                class="danmaku-setting-slider danmaku-setting-step"
                                                                v-model="danmakuShowArea"
                                                                type="range" 
                                                                max="100" 
                                                                min="0" 
                                                                step="25"
                                                            >
                                                        </div>
                                                    <span class="text-[12px] ml-10 progress-val">{{ realDanmakuShowArea }}%</span>
                                                </div>
                                                <div class="setting-opacity-wrap mt-5">
                                                    <span class="text-[12px] mr-5">不透明度</span>
                                                    <div class="setting-opacity-area" :style="{'--opacity': `${getProgressLeftNum(danmakuOpacity, 10, 100)}%`}">
                                                            <div class="setting-opacity-empty"></div>
                                                            <div class="setting-opacity-fill"></div>
                                                            <input 
                                                                class="danmaku-setting-slider"
                                                                v-model="danmakuOpacity"
                                                                type="range" 
                                                                max="100" 
                                                                min="10"
                                                                step="1"
                                                            >
                                                        </div>
                                                    <span class="text-[12px] ml-10 progress-val">{{ danmakuOpacity }}%</span>
                                                </div>
                                                <div class="setting-size-wrap mt-5">
                                                    <span class="text-[12px] mr-5">弹幕字号</span>
                                                    <div class="setting-size-area" :style="{'--size': `${getProgressLeftNum(danmakuSize, 50, 170)}%`}">
                                                            <div class="setting-size-empty"></div>
                                                            <div class="setting-size-fill"></div>
                                                            <input 
                                                                class="danmaku-setting-slider"
                                                                v-model="danmakuSize"
                                                                type="range" 
                                                                max="170" 
                                                                min="50"
                                                                step="1"
                                                            >
                                                        </div>
                                                    <span class="text-[12px] ml-10 progress-val">{{ danmakuSize }}%</span>
                                                </div>
                                                <div class="setting-speed-wrap mt-5">
                                                    <span class="text-[12px] mr-5">弹幕速度</span>
                                                        <div class="setting-speed-area" :style="{'--speed': `${danmakuSpeed}%`}">
                                                            <div class="setting-speed-empty"></div>
                                                            <div class="setting-speed-fill"></div>
                                                            <input 
                                                                class="danmaku-setting-slider danmaku-setting-step"
                                                                v-model="danmakuSpeed"
                                                                type="range" 
                                                                max="100" 
                                                                min="0" 
                                                                step="25"
                                                            >
                                                        </div>
                                                    <span class="text-[12px] ml-10 progress-val">{{ speedProgressVal }}</span>
                                                </div>
                                            </div>
                                        </transition>
                                    </div>
                                </div>
                            </div>
                            <div class="player-control-bottom-right flex-end flex-1">
                                <div @click="handleClickDownloadBtn" v-if="!isSmallWindow">
                                    <span style="color: #fff;">下载</span>
                                </div>
                                <!-- 清晰度 -->
                                <div class="player-ctrl-quality player-ctrl-btn text-[14px] weight-6"  v-if="!isSmallWindow">
                                    <transition name="opacity-fade">
                                        <ul class="player-ctrl-quality-menu weight-5" v-if="isShowQuality">
                                            <li class="player-ctrl-quality-item"
                                                :class="{ 'player-ctrl-quality-item-active': qualityItem.id == curQuality }"
                                                @click="handleQualityMenuItemClick(qualityItem.id)"
                                                v-for="qualityItem of qualityOptional"
                                                :key="qualityItem.id"
                                            >
                                            {{ qualityItem.value }}
                                            </li>
                                        </ul>
                                    </transition>
                                    <div class="player-ctrl-quality-result" @click="handleQualityClick">{{curQualityValue}}</div>
                                </div>
                                <!-- 倍速 -->
                                <div class="player-ctrl-playbackrate player-ctrl-btn text-[14px] weight-6" v-if="!isSmallWindow">
                                    <transition name="opacity-fade">
                                        <ul class="player-ctrl-playbackrate-menu weight-5" v-if="isShowSpeed">
                                            <li class="player-ctrl-playbackrate-item"
                                                :class="{ 'player-ctrl-playbackrate-item-active': speedItem.speed == curSpeed }"
                                                @click="handleSpeedMenuItemClick(speedItem.speed)"
                                                v-for="speedItem of speedOption"
                                                :key="speedItem.speed"
                                            >
                                            {{ speedItem.speed }}x
                                            </li>
                                        </ul>
                                    </transition>
                                    <div class="player-ctrl-playbackrate-result" @click="handleSpeedClick">{{ getpPlaybackrateResult(curSpeed) }}</div>
                                </div>
                                <!-- 字幕 -->
                                <div class="player-ctrl-subtitle player-ctrl-btn" v-if="!isSmallWindow">
                                    <div class="player-ctrl-common-svg">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 112 88" width="112" height="88" preserveAspectRatio="xMidYMid meet" 
                                        style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                            <defs>
                                                <clipPath id="__lottie_element_248">
                                                    <rect width="112" height="88" x="0" y="0">

                                                    </rect>
                                                </clipPath>
                                                <filter id="__lottie_element_253" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%">
                                                    <feComponentTransfer in="SourceGraphic">
                                                        <feFuncA type="table" tableValues="1.0 0.0">

                                                        </feFuncA>
                                                    </feComponentTransfer>
                                                </filter>
                                                <mask id="__lottie_element_252" mask-type="alpha">
                                                    <g filter="url(#__lottie_element_253)">
                                                        <rect width="112" height="88" x="0" y="0" fill="#ffffff" opacity="0">
                                                        </rect>
                                                        <g transform="matrix(1,0,0,1,60.6719970703125,42.452999114990234)" opacity="1" style="display: block;">
                                                            <g opacity="1" transform="matrix(1,0,0,1,-0.5,-0.5)">
                                                                <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-33.94157409667969,-28.281574249267578 
                                                                C-35.50258255004883,-29.84258270263672 -35.50258255004883,-32.377418518066406 -33.94157409667969,-33.93842697143555 
                                                                C-33.94157409667969,-33.93842697143555 -33.93842697143555,-33.94157409667969 -33.93842697143555,-33.94157409667969 
                                                                C-32.377418518066406,-35.50258255004883 -29.84258270263672,-35.50258255004883 -28.281574249267578,-33.94157409667969 
                                                                C-28.281574249267578,-33.94157409667969 33.94157409667969,28.281574249267578 33.94157409667969,28.281574249267578 
                                                                C35.50258255004883,29.84258270263672 35.50258255004883,32.377418518066406 33.94157409667969,33.93842697143555 
                                                                C33.94157409667969,33.93842697143555 33.93842697143555,33.94157409667969 33.93842697143555,33.94157409667969
                                                                C32.377418518066406,35.50258255004883 29.84258270263672,35.50258255004883 28.281574249267578,33.94157409667969 
                                                                C28.281574249267578,33.94157409667969 -33.94157409667969,-28.281574249267578 -33.94157409667969,-28.281574249267578z">
                                                                </path>
                                                            </g>
                                                        </g>
                                                    </g>
                                                </mask>
                                            </defs>
                                            <g clip-path="url(#__lottie_element_248)">
                                                <g mask="url(#__lottie_element_252)" style="display: block;">
                                                    <g transform="matrix(1,0,0,1,56,44)" opacity="1">
                                                        <g opacity="1" transform="matrix(4,0,0,4,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M3.7920000553131104,-4.800000190734863 
                                                            C3.7920000553131104,-4.800000190734863 2.8320000171661377,-4.800000190734863 2.8320000171661377,-4.800000190734863 
                                                            C2.8320000171661377,-4.800000190734863 2.8320000171661377,-4.179999828338623 2.8320000171661377,-4.179999828338623 
                                                            C2.8320000171661377,-4.179999828338623 0.4519999921321869,-4.179999828338623 0.4519999921321869,-4.179999828338623 
                                                            C0.4519999921321869,-4.179999828338623 0.4519999921321869,-3.390000104904175 0.4519999921321869,-3.390000104904175 
                                                            C0.4519999921321869,-3.390000104904175 2.8320000171661377,-3.390000104904175 2.8320000171661377,-3.390000104904175 
                                                            C2.8320000171661377,-3.390000104904175 2.8320000171661377,-2.990000009536743 2.8320000171661377,-2.990000009536743 
                                                            C2.8320000171661377,-2.990000009536743 3.7920000553131104,-2.990000009536743 3.7920000553131104,-2.990000009536743 
                                                            C3.7920000553131104,-2.990000009536743 3.7920000553131104,-3.390000104904175 3.7920000553131104,-3.390000104904175 
                                                            C3.7920000553131104,-3.390000104904175 6.271999835968018,-3.390000104904175 6.271999835968018,-3.390000104904175 
                                                            C6.271999835968018,-3.390000104904175 6.271999835968018,-2.990000009536743 6.271999835968018,-2.990000009536743 
                                                            C6.271999835968018,-2.990000009536743 7.2220001220703125,-2.990000009536743 7.2220001220703125,-2.990000009536743 
                                                            C7.2220001220703125,-2.990000009536743 7.2220001220703125,-3.390000104904175 7.2220001220703125,-3.390000104904175 
                                                            C7.2220001220703125,-3.390000104904175 9.661999702453613,-3.390000104904175 9.661999702453613,-3.390000104904175 
                                                            C9.661999702453613,-3.390000104904175 9.661999702453613,-4.179999828338623 9.661999702453613,-4.179999828338623 
                                                            C9.661999702453613,-4.179999828338623 7.2220001220703125,-4.179999828338623 7.2220001220703125,-4.179999828338623 
                                                            C7.2220001220703125,-4.179999828338623 7.2220001220703125,-4.800000190734863 7.2220001220703125,-4.800000190734863 
                                                            C7.2220001220703125,-4.800000190734863 6.271999835968018,-4.800000190734863 6.271999835968018,-4.800000190734863 
                                                            C6.271999835968018,-4.800000190734863 6.271999835968018,-4.179999828338623 6.271999835968018,-4.179999828338623 
                                                            C6.271999835968018,-4.179999828338623 3.7920000553131104,-4.179999828338623 3.7920000553131104,-4.179999828338623 
                                                            C3.7920000553131104,-4.179999828338623 3.7920000553131104,-4.800000190734863 3.7920000553131104,-4.800000190734863z 
                                                            M7.619999885559082,-2.2079999446868896 C7.619999885559082,-2.2079999446868896 7.619999885559082,-1.628000020980835 
                                                            7.619999885559082,-1.628000020980835 C7.619999885559082,-1.628000020980835 2.499000072479248,-1.628000020980835 
                                                            2.499000072479248,-1.628000020980835 C2.499000072479248,-1.628000020980835 2.499000072479248,-2.2079999446868896 
                                                            2.499000072479248,-2.2079999446868896 C2.499000072479248,-2.2079999446868896 7.619999885559082,-2.2079999446868896 
                                                            7.619999885559082,-2.2079999446868896z M-5.114999771118164,-4.900000095367432 C-5.114999771118164,-4.900000095367432 
                                                            -6.065999984741211,-4.599999904632568 -6.065999984741211,-4.599999904632568 C-5.895999908447266,-4.349999904632568 
                                                            -5.736000061035156,-4.050000190734863 -5.5960001945495605,-3.7799999713897705 
                                                            C-5.5960001945495605,-3.7799999713897705 -9.604999542236328,-3.7799999713897705 
                                                            -9.604999542236328,-3.7799999713897705 C-9.604999542236328,-3.7799999713897705 -9.604999542236328,-1.5299999713897705 
                                                            -9.604999542236328,-1.5299999713897705 C-9.604999542236328,-1.5299999713897705 -8.645000457763672,-1.5299999713897705 
                                                            -8.645000457763672,-1.5299999713897705 C-8.645000457763672,-1.5299999713897705 -8.645000457763672,-2.8499999046325684 
                                                            -8.645000457763672,-2.8499999046325684 C-8.645000457763672,-2.8499999046325684 -1.7960000038146973,-2.8499999046325684 
                                                            -1.7960000038146973,-2.8499999046325684 C-1.7960000038146973,-2.8499999046325684 -1.7960000038146973,-1.5299999713897705 
                                                            -1.7960000038146973,-1.5299999713897705 C-1.7960000038146973,-1.5299999713897705 -0.7960000038146973,-1.5299999713897705
                                                            -0.7960000038146973,-1.5299999713897705 C-0.7960000038146973,-1.5299999713897705 -0.7960000038146973,-3.7799999713897705 
                                                            -0.7960000038146973,-3.7799999713897705 C-0.7960000038146973,-3.7799999713897705 -4.435999870300293,-3.7799999713897705 
                                                            -4.435999870300293,-3.7799999713897705 C-4.585999965667725,-4.119999885559082 -4.84499979019165,-4.550000190734863 
                                                            -5.114999771118164,-4.900000095367432z M7.619999885559082,-1.062999963760376 C7.619999885559082,-1.062999963760376 
                                                            7.619999885559082,-0.46299999952316284 7.619999885559082,-0.46299999952316284 C7.619999885559082,-0.46299999952316284 
                                                            2.499000072479248,-0.46299999952316284 2.499000072479248,-0.46299999952316284 C2.499000072479248,-0.46299999952316284 
                                                            2.499000072479248,-1.062999963760376 2.499000072479248,-1.062999963760376 C2.499000072479248,-1.062999963760376 
                                                            7.619999885559082,-1.062999963760376 7.619999885559082,-1.062999963760376z M6.513999938964844,1.3819999694824219 
                                                            C6.734000205993652,1.6419999599456787 6.994999885559082,1.8919999599456787 7.284999847412109,2.121999979019165 
                                                            C7.284999847412109,2.121999979019165 5.484000205993652,2.121999979019165 5.484000205993652,2.121999979019165 
                                                            C5.484000205993652,2.121999979019165 5.484000205993652,1.5720000267028809 5.484000205993652,1.5720000267028809 
                                                            C5.484000205993652,1.5720000267028809 4.534999847412109,1.5720000267028809 4.534999847412109,1.5720000267028809
                                                            C4.534999847412109,1.5720000267028809 4.534999847412109,2.121999979019165 4.534999847412109,2.121999979019165 
                                                            C4.534999847412109,2.121999979019165 2.813999891281128,2.121999979019165 2.813999891281128,2.121999979019165 
                                                            C3.114000082015991,1.8919999599456787 3.3949999809265137,1.6419999599456787 3.634999990463257,1.3819999694824219 
                                                            C3.634999990463257,1.3819999694824219 6.513999938964844,1.3819999694824219 6.513999938964844,1.3819999694824219z 
                                                            M-2.930000066757202,-1.8550000190734863 C-2.930000066757202,-1.8550000190734863 
                                                            -3.1500000953674316,-1.8049999475479126 -3.1500000953674316,-1.8049999475479126 
                                                            C-3.1500000953674316,-1.8049999475479126 -7.960000038146973,-1.8049999475479126 
                                                            -7.960000038146973,-1.8049999475479126 C-7.960000038146973,-1.8049999475479126 
                                                            -7.960000038146973,-0.8949999809265137 -7.960000038146973,-0.8949999809265137 
                                                            C-7.960000038146973,-0.8949999809265137 -4.130000114440918,-0.8949999809265137 
                                                            -4.130000114440918,-0.8949999809265137 C-4.610000133514404,-0.5049999952316284 
                                                            -5.179999828338623,-0.0949999988079071 -5.71999979019165,0.17499999701976776 C-5.71999979019165,0.17499999701976776 
                                                            -5.71999979019165,0.7850000262260437 -5.71999979019165,0.7850000262260437 C-5.71999979019165,0.7850000262260437 
                                                            -9.699999809265137,0.7850000262260437 -9.699999809265137,0.7850000262260437 C-9.699999809265137,0.7850000262260437 
                                                            -9.699999809265137,1.715000033378601 -9.699999809265137,1.715000033378601 C-9.699999809265137,1.715000033378601 
                                                            -5.71999979019165,1.715000033378601 -5.71999979019165,1.715000033378601 C-5.71999979019165,1.715000033378601 
                                                            -5.71999979019165,3.6449999809265137 -5.71999979019165,3.6449999809265137 C-5.71999979019165,3.7750000953674316 
                                                            -5.769999980926514,3.825000047683716 -5.900000095367432,3.8450000286102295 C-5.900000095367432,3.8450000286102295 
                                                            -6.210000038146973,3.8550000190734863 -6.210000038146973,3.8550000190734863 C-6.210000038146973,3.8550000190734863 
                                                            -6.71999979019165,3.8550000190734863 -6.71999979019165,3.8550000190734863 C-6.980000019073486,3.8550000190734863 
                                                            -7.269999980926514,3.8450000286102295 -7.559999942779541,3.8350000381469727 C-7.400000095367432,4.085000038146973 
                                                            -7.199999809265137,4.525000095367432 -7.139999866485596,4.815000057220459 C-7.139999866485596,4.815000057220459 
                                                            -6.650000095367432,4.815000057220459 -6.650000095367432,4.815000057220459 C-6.650000095367432,4.815000057220459 
                                                            -6.21999979019165,4.795000076293945 -6.21999979019165,4.795000076293945 C-5.820000171661377,4.784999847412109 
                                                            -5.5,4.735000133514404 -5.25,4.644999980926514 C-4.820000171661377,4.494999885559082 
                                                            -4.679999828338623,4.224999904632568 -4.679999828338623,3.674999952316284 C-4.679999828338623,3.674999952316284 
                                                            -4.679999828338623,1.715000033378601 -4.679999828338623,1.715000033378601 C-4.679999828338623,1.715000033378601 
                                                            -0.699999988079071,1.715000033378601 -0.699999988079071,1.715000033378601 C-0.699999988079071,1.715000033378601 
                                                            -0.699999988079071,0.7850000262260437 -0.699999988079071,0.7850000262260437 C-0.699999988079071,0.7850000262260437
                                                            -4.679999828338623,0.7850000262260437 -4.679999828338623,0.7850000262260437 C-4.679999828338623,0.7850000262260437
                                                                -4.679999828338623,0.4950000047683716 -4.679999828338623,0.4950000047683716 
                                                                C-3.7899999618530273,-0.014999999664723873 -2.9100000858306885,-0.6949999928474426 
                                                                -2.2699999809265137,-1.3550000190734863 C-2.2699999809265137,-1.3550000190734863 
                                                                -2.930000066757202,-1.8550000190734863 -2.930000066757202,-1.8550000190734863z 
                                                                M8.600000381469727,-2.805000066757202 C8.600000381469727,-2.805000066757202 1.559999942779541,-2.805000066757202 
                                                                1.559999942779541,-2.805000066757202 C1.559999942779541,-2.805000066757202 1.559999942779541,0.13500000536441803 
                                                                1.559999942779541,0.13500000536441803 C1.559999942779541,0.13500000536441803 3.5,0.13500000536441803 
                                                                3.5,0.13500000536441803 C3.4000000953674316,0.3050000071525574 3.2899999618530273,0.4650000035762787 
                                                                3.1500000953674316,0.6150000095367432 C3.1500000953674316,0.6150000095367432 
                                                                0.38999998569488525,0.6150000095367432 0.38999998569488525,0.6150000095367432 
                                                                C0.38999998569488525,0.6150000095367432 0.38999998569488525,1.3849999904632568 
                                                                0.38999998569488525,1.3849999904632568 C0.38999998569488525,1.3849999904632568 
                                                                2.3499999046325684,1.3849999904632568 2.3499999046325684,1.3849999904632568 
                                                                C1.7999999523162842,1.8250000476837158 1.0800000429153442,2.2249999046325684 
                                                                0.20000000298023224,2.5250000953674316 C0.3799999952316284,2.684999942779541 
                                                                0.6399999856948853,3.0450000762939453 0.75,3.265000104904175 C1.2200000286102295,3.075000047683716 
                                                                1.6399999856948853,2.875 2.0299999713897705,2.6449999809265137 C2.0299999713897705,2.6449999809265137 
                                                                2.0299999713897705,4.614999771118164 2.0299999713897705,4.614999771118164 C2.0299999713897705,4.614999771118164 
                                                                2.9600000381469727,4.614999771118164 2.9600000381469727,4.614999771118164 C2.9600000381469727,4.614999771118164 
                                                                2.9600000381469727,2.884999990463257 2.9600000381469727,2.884999990463257 C2.9600000381469727,2.884999990463257 
                                                                4.539999961853027,2.884999990463257 4.539999961853027,2.884999990463257 C4.539999961853027,2.884999990463257 
                                                                4.539999961853027,4.824999809265137 4.539999961853027,4.824999809265137 C4.539999961853027,4.824999809265137 
                                                                5.480000019073486,4.824999809265137 5.480000019073486,4.824999809265137 C5.480000019073486,4.824999809265137 
                                                                5.480000019073486,2.884999990463257 5.480000019073486,2.884999990463257 C5.480000019073486,2.884999990463257 
                                                                7.239999771118164,2.884999990463257 7.239999771118164,2.884999990463257 C7.239999771118164,2.884999990463257 
                                                                7.239999771118164,3.734999895095825 7.239999771118164,3.734999895095825 C7.239999771118164,3.8450000286102295 
                                                                7.190000057220459,3.875 7.079999923706055,3.875 C7.079999923706055,3.875 6.570000171661377,3.865000009536743 
                                                                6.570000171661377,3.865000009536743 C6.46999979019165,3.865000009536743 6.360000133514404,3.865000009536743 
                                                                6.25,3.865000009536743 C6.349999904632568,4.085000038146973 6.460000038146973,4.364999771118164 
                                                                6.5,4.59499979019165 C6.5,4.59499979019165 6.920000076293945,4.59499979019165 
                                                                6.920000076293945,4.59499979019165 C7.309999942779541,4.59499979019165 7.599999904632568,4.574999809265137 
                                                                7.809999942779541,4.485000133514404 C8.100000381469727,4.355000019073486 8.170000076293945,4.15500020980835 
                                                                8.170000076293945,3.744999885559082 C8.170000076293945,3.744999885559082 8.170000076293945,2.7049999237060547 
                                                                8.170000076293945,2.7049999237060547 C8.550000190734863,2.924999952316284 8.960000038146973,3.0950000286102295 
                                                                9.369999885559082,3.2249999046325684 C9.479999542236328,3.005000114440918 9.739999771118164,2.6549999713897705 
                                                                9.9399995803833,2.494999885559082 C9.069999694824219,2.2750000953674316 8.199999809265137,1.875 
                                                                7.559999942779541,1.3849999904632568 C7.559999942779541,1.3849999904632568 9.699999809265137,1.3849999904632568 
                                                                9.699999809265137,1.3849999904632568 C9.699999809265137,1.3849999904632568 9.699999809265137,0.6150000095367432 
                                                                9.699999809265137,0.6150000095367432 C9.699999809265137,0.6150000095367432 4.260000228881836,0.6150000095367432 
                                                                4.260000228881836,0.6150000095367432 C4.369999885559082,0.4650000035762787 4.46999979019165,0.3050000071525574 
                                                                4.570000171661377,0.13500000536441803 C4.570000171661377,0.13500000536441803 8.600000381469727,0.13500000536441803
                                                                8.600000381469727,0.13500000536441803 C8.600000381469727,0.13500000536441803 8.600000381469727,-2.805000066757202
                                                                8.600000381469727,-2.805000066757202z M10,-6.5 C11.100000381469727,-6.5 12,-5.599999904632568 12,-4.5 
                                                                C12,-4.5 12,4.492000102996826 12,4.492000102996826 C12,5.5920000076293945 11.100000381469727,6.492000102996826 
                                                                10,6.492000102996826 C10,6.492000102996826 -10,6.492000102996826 -10,6.492000102996826 
                                                                C-11.100000381469727,6.492000102996826 -12,5.5920000076293945 -12,4.492000102996826 C-12,4.492000102996826 
                                                                -12,-4.5 -12,-4.5 C-12,-5.599999904632568 -11.100000381469727,-6.5 -10,-6.5 C-10,-6.5 10,-6.5 10,-6.5z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                </g>
                                                <g transform="matrix(1,0,0,1,54.4219970703125,47.577999114990234)" opacity="1" style="display: block;">
                                                    <g opacity="1" transform="matrix(1,0,0,1,-0.5,-0.5)">
                                                        <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-33.94157409667969,-28.281574249267578 
                                                        C-35.50258255004883,-29.84258270263672 -35.50258255004883,-32.377418518066406 -33.94157409667969,-33.93842697143555
                                                            C-33.94157409667969,-33.93842697143555 -33.93842697143555,-33.94157409667969 -33.93842697143555,-33.94157409667969 
                                                            C-32.377418518066406,-35.50258255004883 -29.84258270263672,-35.50258255004883 -28.281574249267578,-33.94157409667969
                                                            C-28.281574249267578,-33.94157409667969 33.94157409667969,28.281574249267578 33.94157409667969,28.281574249267578 
                                                            C35.50258255004883,29.84258270263672 35.50258255004883,32.377418518066406 33.94157409667969,33.93842697143555 
                                                            C33.94157409667969,33.93842697143555 33.93842697143555,33.94157409667969 33.93842697143555,33.94157409667969 
                                                            C32.377418518066406,35.50258255004883 29.84258270263672,35.50258255004883 28.281574249267578,33.94157409667969 
                                                            C28.281574249267578,33.94157409667969 -33.94157409667969,-28.281574249267578 
                                                            -33.94157409667969,-28.281574249267578z">
                                                        </path>
                                                    </g>
                                                </g>
                                            </g>
                                        </svg>
                                    </div>
                                </div>
                                <!-- 音量 -->
                                <div class="player-ctrl-volume player-ctrl-btn" @mouseover="handleVolumesMouseOver" @mouseleave="handleVolumesMouseLeave">
                                    <transition name="opacity-fade">
                                        <div class="player-ctrl-volume-box flex-column" :style="{'--volume': `${curVideoVolume}%`}" v-if="isShowVolume">
                                            <div class="player-ctrl-volume-box-area">
                                                <div class="player-ctrl-volume-box-wrap">
                                                    <div class="volume-empty"></div>
                                                    <div class="volume-fill"></div>
                                                    <input type="range" class="volume-slider"  min="0" max="100" step="1" v-model="curVideoVolume" @input="handleChangeVolume">
                                                </div>
                                            </div>
                                            <div class="player-ctrl-volume-number">
                                                <span>{{ curVideoVolume }}%</span>
                                            </div>
                                        </div>
                                    </transition>
  
                                    <div class="player-ctrl-common-svg">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" width="88" height="88" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                            <defs>
                                                <clipPath id="__lottie_element_60">
                                                    <rect width="88" height="88" x="0" y="0"></rect>
                                                </clipPath>
                                                <clipPath id="__lottie_element_62">
                                                    <path d="M0,0 L88,0 L88,88 L0,88z"></path>
                                                </clipPath>
                                            </defs>
                                            <g clip-path="url(#__lottie_element_60)">
                                                <g clip-path="url(#__lottie_element_62)" transform="matrix(1,0,0,1,0,0)" opacity="1" style="display: block;">
                                                    <g transform="matrix(1,0,0,1,28,44)" opacity="1" style="display: block;">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M15.5600004196167,-25.089000701904297 C15.850000381469727,-24.729000091552734 16,-24.288999557495117 16,-23.839000701904297 C16,-23.839000701904297 
                                                            16,23.840999603271484 16,23.840999603271484 C16,24.94099998474121 15.100000381469727,25.840999603271484 14,25.840999603271484 C13.550000190734863,25.840999603271484 13.109999656677246,25.680999755859375 
                                                            12.75,25.400999069213867 C12.75,25.400999069213867 -4,12.00100040435791 -4,12.00100040435791 C-4,12.00100040435791 -8,12.00100040435791 -8,12.00100040435791 C-12.420000076293945,12.00100040435791 
                                                            -16,8.420999526977539 -16,4.000999927520752 C-16,4.000999927520752 -16,-3.999000072479248 -16,-3.999000072479248 C-16,-8.418999671936035 -12.420000076293945,-11.99899959564209 -8,-11.99899959564209 
                                                            C-8,-11.99899959564209 -4,-11.99899959564209 -4,-11.99899959564209 C-4,-11.99899959564209 12.75,-25.39900016784668 12.75,-25.39900016784668 C13.609999656677246,-26.089000701904297 14.869999885559082,
                                                            -25.948999404907227 15.5600004196167,-25.089000701904297z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g style="display: none;" transform="matrix(1.0074011087417603,0,0,1.0074011087417603,56.02903747558594,44.00049591064453)" opacity="0.01692792263200147">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-4,-13.859000205993652 C0.7799999713897705,-11.08899974822998 4,-5.919000148773193 4,0.0010000000474974513 C4,5.921000003814697 0.7799999713897705,
                                                            11.090999603271484 -4,13.861000061035156 C-4,13.861000061035156 -4,-13.859000205993652 -4,-13.859000205993652z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g style="display: none;" transform="matrix(1.0126574039459229,0,0,1.0126574039459229,64.37825012207031,44.0057487487793)" opacity="0.0028306050683978867">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-6.236000061035156,-28.895999908447266 C4.803999900817871,-23.615999221801758 11.984000205993652,-12.456000328063965 11.984000205993652,
                                                            -0.006000000052154064 C11.984000205993652,12.454000473022461 4.794000148773193,23.624000549316406 -6.265999794006348,28.893999099731445 C-8.255999565124512,29.8439998626709 -10.645999908447266,
                                                            29.003999710083008 -11.595999717712402,27.003999710083008 C-12.545999526977539,25.013999938964844 -11.696000099182129,22.624000549316406 -9.706000328063965,21.673999786376953 C-1.406000018119812,
                                                            17.724000930786133 3.9839999675750732,9.343999862670898 3.9839999675750732,-0.006000000052154064 C3.9839999675750732,-9.345999717712402 -1.3960000276565552,-17.715999603271484 -9.675999641418457,
                                                            -21.676000595092773 C-11.675999641418457,-22.625999450683594 -12.515999794006348,-25.016000747680664 -11.565999984741211,-27.006000518798828 C-10.616000175476074,-29.006000518798828 -8.22599983215332,
                                                            -29.84600067138672 -6.236000061035156,-28.895999908447266z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g style="display: none;" transform="matrix(1.0002120733261108,0,0,1.0002120733261108,56.00299072265625,44)" opacity="0.9999997280440319">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-4,-13.859000205993652 C0.7799999713897705,-11.08899974822998 4,-5.919000148773193 4,0.0010000000474974513 C4,5.921000003814697 0.7799999713897705,
                                                            11.090999603271484 -4,13.861000061035156 C-4,13.861000061035156 -4,-13.859000205993652 -4,-13.859000205993652z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g style="display: none;" transform="matrix(1.0002062320709229,0,0,1.0002062320709229,64.00399780273438,44.00699996948242)" opacity="1">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-6.236000061035156,-28.895999908447266 C4.803999900817871,-23.615999221801758 11.984000205993652,-12.456000328063965 11.984000205993652,-0.006000000052154064 
                                                            C11.984000205993652,12.454000473022461 4.794000148773193,23.624000549316406 -6.265999794006348,28.893999099731445 C-8.255999565124512,29.8439998626709 -10.645999908447266,29.003999710083008 
                                                            -11.595999717712402,27.003999710083008 C-12.545999526977539,25.013999938964844 -11.696000099182129,22.624000549316406 -9.706000328063965,21.673999786376953 C-1.406000018119812,17.724000930786133 
                                                            3.9839999675750732,9.343999862670898 3.9839999675750732,-0.006000000052154064 C3.9839999675750732,-9.345999717712402 -1.3960000276565552,-17.715999603271484 -9.675999641418457,-21.676000595092773 
                                                            C-11.675999641418457,-22.625999450683594 -12.515999794006348,-25.016000747680664 -11.565999984741211,-27.006000518798828 C-10.616000175476074,-29.006000518798828 -8.22599983215332,-29.84600067138672 
                                                            -6.236000061035156,-28.895999908447266z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g transform="matrix(1,0,0,1,56,44)" opacity="1" style="display: block;">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-4,-13.859000205993652 C0.7799999713897705,-11.08899974822998 4,-5.919000148773193 4,0.0010000000474974513 C4,5.921000003814697 0.7799999713897705,
                                                            11.090999603271484 -4,13.861000061035156 C-4,13.861000061035156 -4,-13.859000205993652 -4,-13.859000205993652z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                    <g transform="matrix(1,0,0,1,64.01399993896484,44.00699996948242)" opacity="1" style="display: block;">
                                                        <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                            <path fill="rgb(255,255,255)" fill-opacity="1" d=" M-6.236000061035156,-28.895999908447266 C4.803999900817871,-23.615999221801758 11.984000205993652,-12.456000328063965 11.984000205993652,-0.006000000052154064
                                                            C11.984000205993652,12.454000473022461 4.794000148773193,23.624000549316406 -6.265999794006348,28.893999099731445 C-8.255999565124512,29.8439998626709 -10.645999908447266,29.003999710083008 
                                                            -11.595999717712402,27.003999710083008 C-12.545999526977539,25.013999938964844 -11.696000099182129,22.624000549316406 -9.706000328063965,21.673999786376953 C-1.406000018119812,17.724000930786133 
                                                            3.9839999675750732,9.343999862670898 3.9839999675750732,-0.006000000052154064 C3.9839999675750732,-9.345999717712402 -1.3960000276565552,-17.715999603271484 -9.675999641418457,-21.676000595092773 
                                                            C-11.675999641418457,-22.625999450683594 -12.515999794006348,-25.016000747680664 -11.565999984741211,-27.006000518798828 C-10.616000175476074,-29.006000518798828 -8.22599983215332,-29.84600067138672 
                                                            -6.236000061035156,-28.895999908447266z">
                                                            </path>
                                                        </g>
                                                    </g>
                                                </g>
                                            </g>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </transition>
                <transition name="player-control-fade-start">
                    <!-- 底部进度条 -->
                    <div class="player-control-disvisiable-wrap" v-show="!isMouseMoving">
                        <div class="player-control-top">
                            <div class="player-process">
                                <div class="player-process-main"></div>
                                <div class="player-process-current" :style="{width: currentProcess + '%'}"></div>
                                <div class="player-process-buffer" :style="{width: bufferedProcess + '%'}"></div>
                            </div>
                        </div>
                    </div>
                </transition>
                <!-- 隐藏简介按钮 -->
                <div 
                    class="player-hide-introduce-btn flex-center" 
                    :style="isShowIntroduce ? 'transform: translateY(-50%);  border-radius: 5px 0 0 5px; ' : 'transform: translateY(-50%) rotate(180deg); border-radius: 0 5px 5px 0;'" 
                    v-show="isMouseMoving" 
                    @click.capture="handleClickHideIntroduceBtn"
                >
                    <component :is="rightIcon" class="img"></component>
                </div>

                <!-- 暂停按钮 -->
                <div class="player-state-wrap" v-if="!isPlaying">
                    <div class="player-pause-btn">
                        <component :is="playIcon" class="img"></component>
                    </div>
                </div>
            </div>
            <div class="player-video-danmuku">
                <Danmuku 
                    ref="danmakuRef" 
                    :playerVideoInfo="videoInfo" 
                    :curPlayerTime="currentPlayerTime"
                    :danmakuSetting="danmakuSettingData"
                    :positionTrigger="isShowIntroduce"
                >
                </Danmuku>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
    import { computed, ref, Ref, inject, watch, onMounted, onUnmounted, nextTick } from 'vue';
    import { useStore } from 'vuex';
    import * as R from 'ramda';
    import debounce from '@/utils/common/debounce';
    import fetchVideoStream from '@/utils/videoStreamSingle';
    import { getHomePlayUrl, getHomeVideoShot } from '@/api/home';
    import throttle from '@/utils/common/throttle';
    import withLock from '@/utils/common/withLock';
    import { formatSeconds } from '@/utils/videoFormatInfo';
    import Danmuku from '@/components/Danmuku/index.vue';
    import playIcon from '@/assets/player/play.svg';
    import rightIcon from '@/assets/icon/common/right.svg';

    interface DanmakuElement extends HTMLElement {
        resetCurIndex: (curPlayerTime: number) => void,
        closeDanmaku: () => void,
        openDanmaku: () => void,
        pauseDanmaku: () => void,
    }

    interface QualityOptionItem {
        id: number,
        value: string,
    }
    
    interface ShotInfo {
        image: string[],
        img_x_len: number,
        img_x_size: number,
        img_y_len: number,
        img_y_size: number,
        index: number[],
        pvdata: string
    }

    interface StreamInfo {
        SegmentBase: {
            Initialization: string,
            indexRange: string
        };
        backupUrl: string[];
        backup_url: string[];
        bandwidth: number;
        baseUrl: string; 
        base_url: string;
        codecid: number;
        codecs: string;
        frameRate: string;
        frame_rate: string;
        height: number;
        id: number;
        mimeType: string;
        mime_type: string;
        sar: string;
        segment_base: {
            Initialization: string,
            indexRange: string
        };
        startWithSap: number;
        start_with_sap: number;
        width: number;
    }

    interface VideoInfoItem {
        aid: number,
        bvid: string,
        cid: number,
        desc: string,
        owner: {
            face: string,
            mid: number,
            name: string
        },
        pubdate: number,
        stat: {
            aid: number,
            coin: number,
            danmaku: number,
            dislike: number,
            evaluation: string,
            favorite: number, 
            like: number,
            reply: number,
            share: number,
            view: number
        },
        title: string,
        videoSrc?: string
    }
    
    const props = defineProps(['windowMode']);
    const emit = defineEmits(['updatePanelState']);
    const store = useStore();
    const sessdata = store.state.userModule.sessdata || '';

    const videoInfo: Ref<VideoInfoItem | null> = inject('videoInfo', ref(null));
    
    let videoBlobUrls = ref([]);
    let stopVideo: ((playVideo?: {cancel: () => void}) => void) | null = null;
    let jumpVideo: ((time: number) => Promise<void>) | null = null;
    let startVideo: (() => Promise<void>) | null = null;
    let playerRef = ref<HTMLMediaElement | null>(null);

    const keepInfoAndPlayVideo = async (videoInfo: Ref<VideoInfoItem>, qualityOptionId = 32) => {
        const videosStreamInfo = await fetchHomeRcmdPlayUrl(videoInfo.value, sessdata);
        if(!videosStreamInfo) return null;
        const { videoOptions, audioOptions }: { videoOptions: StreamInfo[], audioOptions: StreamInfo[] } = videosStreamInfo;
        // ramda对于迭代的函数泛型, 第一个是参数类型第二个是迭代函数返回的类型
        const ids: number[] = R.map<StreamInfo, number>(R.prop('id'))(videoOptions);
        qualityOptional.value = R.filter((item: QualityOptionItem) => R.includes(item.id)(ids))(qualityOptions.value);
        const video = R.filter(R.propEq(qualityOptionId, 'id'))(videoOptions);
        const audio = R.filter(R.propEq(30216, 'id'))(audioOptions);
        if(!playerRef.value) return null;
        return async (currentTime = 0) => {
            return await fetchVideoStream(
                video, 
                videoInfo.value, 
                playerRef as Ref<HTMLMediaElement>, 
                videoBlobUrls, 
                audio[0], 
                sessdata, 
                currentTime
            );
        };
    };
    watch(videoInfo, async () => {
        // 等待playerRef加载完成
        await nextTick();
        if(!videoInfo || !playerRef.value) return;
        let getActions = await keepInfoAndPlayVideo(videoInfo as Ref<VideoInfoItem>, curQuality.value);
        if(!getActions) return;
        // 开启播放并返回操作函数
        const actions = await getActions();
        if(actions) {
            stopVideo = actions.stop;
            jumpVideo = actions.jump;
            startVideo = actions.start;
        };
        playerRef.value.addEventListener('loadedmetadata', handlePlayerLoadMetaData);
        // 清理闭包
        getActions = null;
    }, { once: true });
    const handlePlayerTimeUpdate = () => {
        if(!playerRef.value) return;
        updateCurrentProcess(playerRef.value.currentTime);
        updateCurrentProcessTime(playerRef.value.currentTime);
        updateCurPlayerTime(playerRef.value.currentTime);
    };
    const handlePlayerProcess = () => {
        updateBufferedProcess();
    };

    const handlePlayerLoadMetaData = () => {
        if(!playerRef.value) return;
        updateTotalProcessTime();
        updateCurrentProcessTime(playerRef.value.currentTime);
        playerRef.value.removeEventListener('timeupdate', handlePlayerTimeUpdate);
        playerRef.value.removeEventListener('progress', handlePlayerProcess);
        playerRef.value.addEventListener('timeupdate', handlePlayerTimeUpdate);
        playerRef.value.addEventListener('progress', handlePlayerProcess);
        window.addEventListener('keydown', handleWindowKeyDown);
        window.addEventListener('keyup', handleWindowKeyUp);
    };

    // 获取当前播放时间
    let currentPlayerTime = ref(0);
    const updateCurPlayerTime = throttle(currentTime => {
        currentPlayerTime.value = currentTime;
    }, 1000);
    
    let playerControlRef = ref<HTMLElement | null>(null);
    const handleControlClick = () => {
        updatePlayStateAndAction(!isPlaying.value);
        if(pauseDanmaku) {
            pauseDanmaku();
        };
    };

    // 控制进度条显示
    let isMouseMoving = ref(false);
    const updateIsMouseMovingState = (isMoving: boolean) => {
        isMouseMoving.value = isMoving;
    };
    const showProcessArea = () => updateIsMouseMovingState(true);
    const hideProcessArea = () => {
        updateIsMouseMovingState(false);
        hideControlPopupBar();
    };
    const hideProcessAreaDelay = debounce(hideProcessArea, 1000);
    const cancelHideProcessAreaDelay = hideProcessAreaDelay.cancel;
    const handleControlMouseMove = () => {
        showProcessArea();
        hideProcessAreaDelay();
    };
    const handleControlMouseLeave = () => {
        hideProcessArea();
        hideControlPopupBar();
    };
    const handleControlBottomMouseMove = (event: Event) => {
        event.stopPropagation();
        showProcessArea();
        cancelHideProcessAreaDelay();
    };
    // 控制视频播放与暂停
    let isPlaying = ref(true);
    const updatePlayState = async (playingState: boolean) => {
        isPlaying.value = playingState;
    };
    const updatePlayStateAndAction = async (playingState:boolean) => {
        updatePlayState(playingState);
        if(playingState && startVideo) {
            await startVideo();
        } 
        else if(stopVideo){
            stopVideo();
        };
    };

    // 控制进度条进度显示
    let playerProcessRef = ref<HTMLElement | null>(null);
    let currentProcess = ref(0);
    let currentProcessTime = ref('');
    let totalProcessTime = ref('');
    let isShowHour = ref(false);
    const updateCurrentProcess = (currentTime: number): void => {
        if(!playerRef.value) return;
        currentProcess.value = currentTime / playerRef.value.duration * 100;
    };
    const updateCurrentProcessTime = (currentTime: number) => {
        currentProcessTime.value = formatSeconds(currentTime);
    };
    const updateTotalProcessTime = () => {
        if(!playerRef.value) return;
        const duration = playerRef.value.duration;
        if(Math.floor(duration) > 3600) {
            isShowHour.value = true;
            totalProcessTime.value = formatSeconds(duration, isShowHour.value);
        }
        else {
            totalProcessTime.value = formatSeconds(duration);
        };
    };
    let bufferedProcess = ref(0);
    const updateBufferedProcess = () => {
        if(!playerRef.value) return;
        const buffered = playerRef.value.buffered;
        if(buffered.length > 0) {
            bufferedProcess.value = buffered.end(buffered.length - 1) / playerRef.value.duration * 100;
        };
    };
 
    let shotInfo = ref<ShotInfo | null>(null);
    let shotUrl = ref('');
    // 是否加载完成快照全图
    let isLoadingShotImage = ref(true);
    // 控制视频帧图片显示
    let playerPopupRef = ref<HTMLElement | null>(null);
    let isShowPopup = ref(false);
    const updateShowPopupState = (isShow: boolean) => {
        isShowPopup.value = isShow;
    };
    const findBetween = (arr: number[], target: number) => {
        let index = -1;
        for(let i = 0; i < arr.length - 1; i++) {
            if(arr[i] < target && arr[i + 1] > target) {
                index = i;
                break;
            };
        };
        if(arr[arr.length - 1] < target) {
            index = arr.length - 1;
        };
        // 如果未找到返回 -1，转换为 null
        return index === -1 ? null : index;
    };
    const handleProcessBarMouseEnter = async () => {
        if(!videoInfo.value) return;
        const { aid = '', bvid = '', cid = '' } = videoInfo.value;
        const response: ShotInfo | string = await fetchHomeVideoShot({aid, bvid, cid});
        if(typeof response === 'string') {
            ElMessage.error(response);
        }
        else {
            shotInfo.value = response;
        };
    };
    // 是否在拖动
    let isDraging = false;
    const updateDragState = (dragState: boolean) => {
        isDraging = dragState;
    };
    // down => move => up => click
    // 鼠标按下window监听事件
    const handleProcessBarMouseDown = () => {
        updateDragState(true);
        if(playerRef.value) {
            playerRef.value.removeEventListener('timeupdate', handlePlayerTimeUpdate);
        };
        window.addEventListener('mousemove', handleWindowMouseMoveThrottle, true);
        window.addEventListener('mouseup', handleWindowMouseUp, true);
        window.addEventListener('click', handleWindowClick, true);
    };
    const preprocessingProcessBarMouseMoveAction = () => {
        // 鼠标X坐标
        let mouseX = 0;
         // 元素当前X坐标
        let elementX = 0;
        // 用于检测快照是否改变
        let oldShotIndex: number | null = null;
        // 用于检测图片是否改变
        let oldImageIndex: number | null = null;
        // 用于裁剪的图片样本
        const image = new Image();
        image.crossOrigin = 'anonymous';
        // 用于生成图片的画布
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        // 是否需要移动 控制动画函数的调用
        let isMoving = false;
        // 是否到边界
        let isEnd = false;
        return throttle(async (event) => {
            if(!playerProcessRef.value || !playerPopupRef.value || !playerRef.value || !ctx) {
                return;
            };
            const rect = playerProcessRef.value.getBoundingClientRect();
            // 获取鼠标相对于进度条左端的距离
            mouseX = event.clientX - rect.left;
            elementX = playerPopupRef.value.getBoundingClientRect().left;
            const width = rect.width;
            // 禁止直接跳转到结尾
            const maxProcess = (playerRef.value.duration - 1) / playerRef.value.duration * 100;
            // 处理拖动的情况
            if(isDraging) {
                currentProcess.value = mouseX / width * 100;
                if(currentProcess.value > maxProcess) {
                    currentProcess.value = maxProcess;
                } 
                else if(currentProcess.value < 0) {
                    currentProcess.value = 0;
                };
            };
            if(shotInfo.value) {
                // 获取快照
                const timeShotArr = shotInfo.value.index;
                const timeShotFilteredArr = R.slice(1, timeShotArr.length, timeShotArr);
                const mouseTime = playerRef.value.duration * mouseX / width;
                const timeShotIndex = findBetween(timeShotFilteredArr, mouseTime);
                // 没有改变快照则退出
                if(timeShotIndex === null || oldShotIndex === timeShotIndex) {
                    return;
                };
                oldShotIndex = timeShotIndex;
                // 一张图片最多的快照数量
                const maxImageShots = shotInfo.value.img_x_len * shotInfo.value.img_y_len;
                const imageIndex = Math.floor(timeShotIndex / maxImageShots);
                // 修改了图片则需要加载
                if(oldImageIndex !== imageIndex) {
                    isLoadingShotImage.value = true;
                    oldImageIndex = imageIndex;
                };
                image.src = shotInfo.value.image[imageIndex];
                // 裁剪的宽度
                const cropWidth = shotInfo.value.img_x_size;
                // 裁剪的高度
                const cropHeight = shotInfo.value.img_y_size;
                // 从0开始
                const startRow = Math.floor((timeShotIndex - imageIndex * maxImageShots) % shotInfo.value.img_x_len);
                const startColumn = Math.floor((timeShotIndex - imageIndex * maxImageShots) / shotInfo.value.img_x_len);
                // 裁剪的起始X坐标
                const cropX = startRow * cropWidth;
                // 裁剪的起始Y坐标
                const cropY = startColumn * cropHeight;
                image.onload = function() {
                    // 设置 canvas 尺寸为裁剪区域的大小
                    canvas.width = cropWidth;
                    canvas.height = cropHeight;
                    // 使用 drawImage 裁剪并绘制图片
                    ctx.drawImage(image, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
                    shotUrl.value = canvas.toDataURL();
                    isLoadingShotImage.value = false;
                    // 隐藏控制栏弹出框
                    hideControlPopupBar();
                };
                const popupWidth = 160;
                const maxLeft = width - popupWidth / 2;
                const minLeft = popupWidth / 2;
                const animate = () => {
                    const speed = 0.1;
                    elementX += (mouseX - elementX) * speed;
                    if(!playerPopupRef.value) {
                        return;
                    };
                    isEnd = false;
                    if(mouseX > maxLeft) {
                        mouseX = maxLeft;
                        isEnd = true;
                    }
                    else if(mouseX < minLeft) {
                        mouseX = minLeft;
                        isEnd = true;
                    };
                    playerPopupRef.value.style.left = mouseX - popupWidth / 2 + 'px';
                    // 判断是否继续调用
                    const distanceX = Math.abs(mouseX - elementX);
                    if(distanceX > 0.5 && !isEnd) {
                        requestAnimationFrame(animate);
                    }
                    // 已经到达目标位置或者到边界无法继续移动
                    else {
                        isMoving = false;
                    };
                };
                if(!isMoving) {
                    isMoving = true;
                    animate();
                };
                updateShowPopupState(true);
            };
        }, 16);
    };
    // 记录快照出现的定时器
    let isProhibitShotImg: boolean = true;
    const updateIsProhibitShotImgState = (isProhibit: boolean) => {
        isProhibitShotImg = isProhibit;
    };
    let processBarMouseMoveTimer: ReturnType<typeof setTimeout> | null = null;
    let handleProcessBarMouseMoveThrottle: ((event: Event) => void) | null = preprocessingProcessBarMouseMoveAction();
    const handleProcessBarMouseMove = (event: Event) => {
        if(handleProcessBarMouseMoveThrottle) {
            if(isProhibitShotImg && !processBarMouseMoveTimer) {
                processBarMouseMoveTimer = setTimeout(() => {
                    (handleProcessBarMouseMoveThrottle as (event: Event) => void)(event);
                    updateIsProhibitShotImgState(false);
                }, 1000);
            }
            else if(!isProhibitShotImg) {
                handleProcessBarMouseMoveThrottle(event);
            };
        };
    };
    const handleProcessBarMouseUp = () => {
        updateDragState(false);
    };
    const handleProcessBarClick = async (event: MouseEvent) => {
        if(!playerProcessRef.value || !playerRef.value || !jumpVideo || !resetDanmakuCurIndex) {
            return;
        };
        const rect = playerProcessRef.value.getBoundingClientRect();
        const offsetX = event.clientX - rect.left;
        const width = rect.width;
        let positionPrecent = offsetX / width;
        // 禁止跳转到结尾
        const maxPositionPrecent = (playerRef.value.duration - 1) / playerRef.value.duration;
        if(positionPrecent > maxPositionPrecent) {
            positionPrecent = maxPositionPrecent;
        } 
        else if(positionPrecent < 0) {
            positionPrecent = 0;
        };
        const time = playerRef.value.duration * positionPrecent;
        await jumpVideo(time);
        playerRef.value.addEventListener('timeupdate', handlePlayerTimeUpdate);
        updatePlayStateAndAction(true);
        updateShowPopupState(false);
        resetDanmakuCurIndex(time);
    };
    const handleProcessBarMouseLeave = () => {
        updateShowPopupState(false);
        if(processBarMouseMoveTimer) {
            clearTimeout(processBarMouseMoveTimer);
            processBarMouseMoveTimer = null;
        };
        updateIsProhibitShotImgState(true);
    };
    const handleWindowMouseMoveThrottle = (event: Event) => {
        if(!handleProcessBarMouseMoveThrottle) {
            return;
        };
        handleProcessBarMouseMoveThrottle(event);
    };
    const handleWindowMouseUp = (event: Event) => {
        event.stopPropagation();
        handleProcessBarMouseUp();
    };
    const handleWindowClick = (event: MouseEvent) => {
        event.stopPropagation();
        handleProcessBarClick(event);
        window.removeEventListener('mousemove', handleWindowMouseMoveThrottle, true);
        window.removeEventListener('mouseup', handleWindowMouseUp, true);
        window.removeEventListener('click', handleWindowClick, true);
    };

    // **播放器操作模块

    const handleClickCtrlBtn = () => {
        if(!isPlaying.value) {
            updatePlayStateAndAction(true);
        } 
        else {
            updatePlayStateAndAction(false);
        };
        if(pauseDanmaku) {
            pauseDanmaku();
        };
    };

    const curVideoVolume = ref(50);
    const updatePlayerVolume = async (volume: string | number) => {
        try {
            let volumeNum = Number(volume);
            if(volumeNum > 100) {
                volumeNum = 100;
            }
            else if(volumeNum < 0) {
                volumeNum = 0;
            };
            await nextTick();
            if(!playerRef.value) {
                return;
            };
            if('volume' in playerRef.value && playerRef.value.volume === volumeNum / 100) {
                return;
            };
            playerRef.value.volume = volumeNum / 100;
        } catch(err) {
            console.log('音量修改失败', err);
        };
    };
    const handleChangeVolume = async () => {
        await updatePlayerVolume(curVideoVolume.value);
    };

    // 下载视频
    const handleClickDownloadBtn = () => {
        if(!videoInfo.value) return;
        const { bvid = '', cid = ''} = videoInfo.value;
        window.electronAPI.sendMessage('download_video', { bvid, cid, sessdata, videoId: curQuality.value });
    };

    // 控制音量显示
    let isShowVolume = ref(false);
    let hideVolumeTimer: ReturnType<typeof setTimeout> | null = null;
    const updateShowVolumeState = (volumeState: boolean) => {
        if(volumeState && hideVolumeTimer) {
            clearTimeout(hideVolumeTimer);
            hideVolumeTimer = null;
        };
        isShowVolume.value = volumeState;
    };
    const handleVolumesMouseOver = () => {
        updateShowVolumeState(true);
    };
    const handleVolumesMouseLeave = () => {
        hideVolumeTimer = setTimeout(() => {
            updateShowVolumeState(false);
        }, 200);
    };
    
    // 控制倍速
    const speedOption = [{speed: '0.5'}, {speed: '0.75'}, {speed: '1.0'}, {speed: '1.25'}, {speed: '1.5'}, {speed: '2.0'}];
    let curSpeed = ref('1.0');
    let isShowSpeed = ref(false);
    const updateShowSpeedState = (speedState: boolean) => {
        isShowSpeed.value = speedState;
    };
    const updatePlayerSpeed = async (speed: number | string) => {
        if(!speed) {
            return;
        };
        const speedNum = Number(speed);
        await nextTick();
        if(!playerRef.value) {
            return;
        };
        playerRef.value.playbackRate = speedNum;
    };
    const updateCurSpeed = (speed: number | string) => {
        if(!speed) {
            return;
        };
        curSpeed.value = String(speed);
    };
    const handleSpeedClick = () => {
        if(!isShowSpeed.value) hideControlPopupBar();
        updateShowSpeedState(!isShowSpeed.value);
    };
    const handleSpeedMenuItemClick = async (speed: number | string) => {
        if(speed === curSpeed.value) {
            return;
        };
        await updatePlayerSpeed(speed);
        updateCurSpeed(speed);
        updateShowSpeedState(false);
    };
    const getpPlaybackrateResult = (speed: number | string) => {
        return speed === '1.0' ? '倍速' : `${speed}x`;
    };

    // 控制清晰度
    let isShowQuality = ref(false);
    let curQuality = ref<number>(32);
    const qualityOptions = ref<QualityOptionItem[]>([
        {id: 116, value: '4K超清'},
        {id: 112, value: '1080P+高清'}, 
        {id: 80, value: '1080P高清'}, 
        {id: 74, value: '720P60'}, 
        {id: 64, value: '720P高清'}, 
        {id: 32, value: '480P清晰'}, 
        {id: 16, value: '360P流畅'}, 
        {id: 6, value: '240P极速'}
    ]);
    // 可选的清晰度
    const qualityOptional = ref<{id: number, value: string}[]>([]);
    const updateShowQualityState = (qualityState: boolean) => {
        isShowQuality.value = qualityState;
    };
    const updateCurQuality = (qualityId: number) => {
        curQuality.value = qualityId;
    };
    const curQualityValue = computed(() => {
        const quality  = R.find(R.propEq(curQuality.value, 'id'))(qualityOptions.value) as { id: number, value: string } | undefined;
        return quality ? quality.value : '';
    });

    const switchQuality = async (qualityId: number) => {
        await nextTick();
        // 停止播放防止SourceBuffer 被移除后仍然在访问
        if(stopVideo) {
            stopVideo();
        };
        if(!playerRef.value || !videoInfo.value) {
            return;
        };
        const currentTime = playerRef.value.currentTime;
        let getActions = await keepInfoAndPlayVideo(videoInfo as Ref<VideoInfoItem>, qualityId);
        if(!getActions) return;
        const actions = await getActions(currentTime);
        if(actions) {
            stopVideo = actions.stop;
            jumpVideo = actions.jump;
            startVideo = actions.start;
        };
        getActions = null;
        updatePlayState(true);
        // if(pauseDanmaku) pauseDanmaku();
    };

    const handleQualityClick = () => {
        if(!isShowQuality.value) hideControlPopupBar();
        updateShowQualityState(!isShowQuality.value);
    };
    const handleQualityMenuItemClick = async (quailtyId: number) => {
        if(quailtyId === curQuality.value) {
            return;
        };
        updateCurQuality(quailtyId);
        updateShowQualityState(false);
        await switchQuality(quailtyId);
    };

    // 控制弹幕显示
    // 弹幕组件
    const danmakuRef = ref<DanmakuElement | null>(null);
    let resetDanmakuCurIndex: ((curPlayerTime: number) => void) | null = null;
    let closeDanmaku: (() => void) | null = null;
    let openDanmaku: (() => void) | null = null;
    let pauseDanmaku: (() => void) | null = null;
    let isDanmakuClosed = ref(false);
    const updateDanmakuState = (danmakuState: boolean) => {
        isDanmakuClosed.value = danmakuState;
    };

    const handleClickDanmakuSwitchBtn = () => {
        if(isDanmakuClosed.value && openDanmaku) {
            openDanmaku();
        }
        else if(closeDanmaku) {
            closeDanmaku();
        };
        updateDanmakuState(!isDanmakuClosed.value);
    };

    let isShowSetting = ref(false);
    const updateShowSettingState = (settingState: boolean) => {
        isShowSetting.value = settingState;
    };

    const handleClickDanmakuSettingBtn = () => {
        updateShowSettingState(!isShowSetting.value);
    };

    // 弹幕设置
    // 显示区域
    let danmakuShowArea = ref(25);
    let realDanmakuShowArea = computed(() => Number(danmakuShowArea.value) > 10 ? danmakuShowArea.value : 10);
    let danmakuOpacity = ref(70);
    let danmakuSize = ref(80);
    let danmakuSpeed = ref(25);
    let danmakuSettingData = computed(() => ref({
        danmakuShowArea: Number(realDanmakuShowArea.value),
        danmakuOpacity: Number(danmakuOpacity.value),
        danmakuSize: Number(danmakuSize.value),
        danmakuSpeed: Number(danmakuSpeed.value)
    }));
    const speedProgressVal: Ref<string> = computed(() => {
        switch (true) {
            case danmakuSpeed.value == 0:
                return '极慢';
            case danmakuSpeed.value > 0 && danmakuSpeed.value <= 25:
                return '较慢';
            case danmakuSpeed.value > 25 && danmakuSpeed.value <= 50:
                return '适中';
            case danmakuSpeed.value > 50 && danmakuSpeed.value <= 75:
                return '较快';
            case danmakuSpeed.value > 75:
                return '极快';
            default:
                return '';
        };
    });
    const getProgressLeftNum = (value: number, min: number, max: number): number => (value - min) / (max - min) * 100;

    // 清除所有弹出框
    const hideControlPopupBar = () => {
        updateShowVolumeState(false);
        updateShowSpeedState(false);
        updateShowQualityState(false);
        updateShowSettingState(false);
    };

    const isBuffered = (time: number): boolean => {
        if(!playerRef.value) return false;
        const buffered = playerRef.value.buffered;
        for (let i = 0; i < buffered.length; i++) {
            if (time >= buffered.start(i) && time <= buffered.end(i)) {
                return true;
            };
        };
        return false;
    };

    // 键盘操作事件
    const keydownActions = [
        {key: ' ', action: () => {
            updatePlayStateAndAction(!isPlaying.value);
        }},
        {key: 'ArrowUp', action: async () => {
            curVideoVolume.value = Math.min(100, curVideoVolume.value + 5);
            await updatePlayerVolume(curVideoVolume.value);
        }},
        {key: 'ArrowDown', action: async () => {
            curVideoVolume.value = Math.max(0, curVideoVolume.value - 5);
            await updatePlayerVolume(curVideoVolume.value);
        }},
    ];

    const keyUpActions = [
        {key: 'ArrowRight', action: async () => {
            if(!playerRef.value) return;
            const currentTime = Math.min(playerRef.value.duration, playerRef.value.currentTime + 5);
            const bufferedState = isBuffered(currentTime);
            if(bufferedState) {
                playerRef.value.currentTime = Math.min(playerRef.value.duration, playerRef.value.currentTime + 5);
            }
            else {
                return;
            };
        }},
        {key: 'ArrowLeft', action: withLock(async () => {
            if(!playerRef.value) return;
            const currentTime = Math.max(0, playerRef.value.currentTime - 5);
            const bufferedState = isBuffered(currentTime);
            if(bufferedState) {
                playerRef.value.currentTime = currentTime;
            }
            else if(jumpVideo) {
                await jumpVideo(currentTime);
            };
        })},
    ];

    const handleWindowKeyDown = async (event: KeyboardEvent ) => {
        event.preventDefault();
        const key = event.key;
        const action = R.pipe(
            R.find((item: {key: string, action: () => void}) => item['key'] === key),
            R.propOr(null, 'action') as (data: any) => () => void
        )(keydownActions);
        if(action) {
            await action();
        };
    };
    const handleWindowKeyUp = async (event: KeyboardEvent)  => {
        event.preventDefault();
        
        const key = event.key;
        const action = R.pipe(
            R.find((item: {key: string, action: () => void}) => item['key'] === key),
            R.propOr(null, 'action') as (data: any) => () => void
        )(keyUpActions);
        if(action) {
            await action();
        };
    };

    let isShowIntroduce = ref(true);
    const updateIntroduceState = (state: boolean) => {
        isShowIntroduce.value = state;
    };
    const handleClickHideIntroduceBtn = (event: Event)  => {
        event.stopPropagation();
        updateIntroduceState(!isShowIntroduce.value);
        emit('updatePanelState', isShowIntroduce.value);
    };

    const fetchHomeRcmdPlayUrl: (item: VideoInfoItem, sessdata: string) => Promise<{ videoOptions: []; audioOptions: [] } | null> = R.curry(async (item, sessdata) => {
        const { bvid, cid } = item;
        if(!bvid && !cid) return null;
        const response = await getHomePlayUrl({bvid, cid, fnval: 16}, sessdata);
        const successAction = R.pipe(
            R.path(['data', 'dash']),
            R.applySpec({
                videoOptions: R.pipe(
                    R.prop('video'),
                ),
                audioOptions: R.pipe(
                    R.prop('audio'),
                )
            })
        );
        return R.ifElse(
            R.propEq(0, 'code'),
            successAction,
            () => null
        )(R.path(['data'], response));
    });

    const fetchHomeVideoShot: (ids: { aid: string | number; bvid: string | number; cid: string | number }) => Promise<ShotInfo | string> = R.once(async (ids) => {
        const { aid = '', bvid = '', cid = '' } = ids;
        const response = await getHomeVideoShot({aid, bvid, cid, index: 1});
        const successAction = R.pipe(
            R.path(['data']) as (data: any) => ShotInfo
        );
        const failAction = R.pipe(
            R.pathOr('', ['message']) as (data: any) => string
        );
        return R.ifElse(
            R.propEq(0, 'code'),
            successAction,
            failAction
        )(R.path(['data'], response));
    });

    let isSmallWindow = computed(() => props.windowMode === 'small');
    
    onMounted(async () => {
        updatePlayerSpeed(curSpeed.value);
        updatePlayerVolume(curVideoVolume.value);

        await nextTick();
        if(danmakuRef.value) {
            resetDanmakuCurIndex = danmakuRef.value.resetCurIndex;
            closeDanmaku = danmakuRef.value.closeDanmaku;
            openDanmaku = danmakuRef.value.openDanmaku;
            pauseDanmaku = danmakuRef.value.pauseDanmaku;
        };
    });
    onUnmounted(() => {
        // 清理
        videoBlobUrls.value.forEach(url => {
            URL.revokeObjectURL(url);
        });
        if(playerRef.value) {
            playerRef.value.removeEventListener('timeupdate', handlePlayerTimeUpdate);
            playerRef.value.removeEventListener('progress', handlePlayerProcess);
            playerRef.value.removeEventListener('loadedmetadata', handlePlayerLoadMetaData);
        };
        if(playerControlRef.value) {
            playerControlRef.value.removeEventListener('mousemove', handleControlMouseMove);
            playerControlRef.value.removeEventListener('mouseleave', handleControlMouseLeave);
        };
        if(playerProcessRef.value) {
            playerProcessRef.value.removeEventListener('click', handleProcessBarClick);
            playerProcessRef.value.removeEventListener('mouseenter', handleProcessBarMouseEnter);
            if(handleProcessBarMouseMoveThrottle) playerProcessRef.value.removeEventListener('mousemove', handleProcessBarMouseMoveThrottle);
        };
        window.removeEventListener('keydown', handleWindowKeyDown);
        window.removeEventListener('keyup', handleWindowKeyUp);
        stopVideo = null;
        jumpVideo = null;
        startVideo = null;
        handleProcessBarMouseMoveThrottle = null;
    });
</script>

<style lang="scss" scoped>
    $sideDistance: 12px;
    $processBarHeight: 4px;
    $processBarAreaHeight: 16px;
    ul {
        list-style-type: none;
        outline: none;
        padding: 0;
        margin: 0;
    }
    li {
        margin: 0;
        padding: 0;
    }
    .player-content {
        width: 100%;
        height: 100%;
        background-color: #000;
        .player-video-area {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            .player-video-wrap {
                height: 100%;
                width: 100%;
                video {
                    max-width: 100%;
                    max-height: 100%;
                    background-color: #000;
                    object-fit: contain;
                    overflow-clip-margin: content-box;
                    overflow: clip;
                }
            }
            .player-video-control {
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                z-index: 2;
                .player-control-fade-enter-active, .player-control-fade-leave-active {
                    transition: opacity 0.7s;
                }
                .player-control-fade-enter-from, .player-control-fade-leave-to {
                    opacity: 0;
                }
                .player-control-fade-enter-to, .player-control-fade-leave-from {
                    opacity: 1;
                }

                .player-control-fade-start-enter-active {
                    transition: opacity 0.7s;
                }
                .player-control-fade-start-enter-from, .player-control-fade-start-leave-to {
                    opacity: 0;
                }
                .player-control-fade-start-enter-to, .player-control-fade-start-leave-from {
                    opacity: 1;
                }
                // 父元素层级影响子元素的层级
                .player-control-wrap {
                    position: absolute;
                    bottom: 0;
                    width: 100%;
                    transition: .2s;
                    z-index: 2;
                    .player-control-mask {
                        bottom: 0;
                        height: 100px;
                        left: 0;
                        pointer-events: none;
                        position: absolute;
                        -webkit-transition: opacity .2s ease-in-out;
                        transition: opacity .2s ease-in-out;
                        width: 100%;
                        z-index: -1;
                        background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==") repeat-x bottom;
                    }
                    .player-control-top {
                        position: absolute;
                        bottom: 44px;
                        padding: 0 $sideDistance;
                        box-sizing: border-box;
                        width: 100%;
                        .player-process {
                            position: relative;
                            width: 100%;
                            height: $processBarAreaHeight;
                            box-sizing: border-box;
                            .player-process-area {
                                position: absolute;
                                left: 0;
                                top: 0;
                                width: 100%;
                                height: 100%;
                                box-sizing: border-box;
                                cursor: pointer;
                                .player-process-wrap {
                                    position: absolute;
                                    left: 0;
                                    width: 100%;
                                    height: $processBarHeight;
                                    border-radius: 999px;
                                    overflow: hidden;
                                    .player-process-main {
                                        position: absolute;
                                        left: 0;
                                        top: 0;
                                        z-index: 1;
                                        width: 100%;
                                        height: $processBarHeight;
                                        background-color: hsla(0, 0%, 100%, .2)
                                    }
                                    .player-process-current {
                                        position: absolute;
                                        left: 0;
                                        top: 0;
                                        z-index: 3;
                                        width: 0%;
                                        height: $processBarHeight;
                                        background-color: var(--brand-pink);
                                        max-width: 100%;
                                    }
                                    .player-process-buffer {
                                        position: absolute;
                                        left: 0;
                                        top: 0;
                                        z-index: 2;
                                        width: 0%;
                                        height: $processBarHeight;
                                        background-color: hsla(0, 0%, 100%, .3);
                                        transition: .2s;
                                        max-width: 100%;
                                    }
                                }
                                .player-process-thumb-icon {
                                    position: absolute;
                                    z-index: 4;
                                    width: 20px;
                                    height: 20px;
                                    svg {
                                        width: 100%;
                                        height: 100%;
                                    }
                                }

                            }
                            .player-progress-popup {
                                display: none;
                                position: absolute;
                                bottom: 22px;
                                width: 160px;
                                height: 90px;
                                overflow: hidden;
                                pointer-events: none;
                                background-color: transparent;
                                z-index: 2;
                                transition: .2s;
                                .player-progress-preview-image {
                                    width: 100%;
                                    height: 100%;
                                }
                            }
                        }
                    }
                    .player-control-bottom {
                        display: flex;
                        height: 35px;
                        justify-content: space-between;
                        line-height: 22px;
                        margin: 20px 0 $processBarHeight;
                        transition: all .2s ease-out;
                        width: 100%;
                        padding: 0 $sideDistance;
                        box-sizing: border-box;
                        .player-ctrl-btn {
                            fill: #fff;
                            color: hsla(0, 0%, 100%, .8);
                            height: 22px;
                            width: 36px;
                            line-height: 22px;
                            outline: 0;
                            position: relative;
                            text-align: center;
                            cursor: pointer;
                            .player-ctrl-common-svg {
                                opacity: .9;
                                user-select: none;
                                cursor: pointer;
                                width: 100%;
                                height: 100%;
                                svg {
                                    width: 100%;
                                    height: 100%;
                                    transition: fill .15s ease-in-out;
                                }
                            }
                        }
                        .player-control-bottom-left {
                            .player-ctrl-time {
                                color: #fff;
                                min-width: 100px;
                                .player-ctrl-time-label {
                                    min-width: 40px;
                                }
                            }
                            .player-danmaku-area {
                                fill: #fff;
                                height: 24px;
                                .player-danmaku-switch {
                                    height: 100%;
                                    cursor: pointer;
                                    svg {
                                        width: 24px;
                                        height: 24px;
                                    }
                                }
                                .player-danmaku-setting {
                                    position: relative;
                                    height: 100%;
                                    cursor: pointer;
                                    svg {
                                        width: 24px;
                                        height: 24px;
                                    }
                                    .setting-wrap {
                                        display: flex;
                                        flex-direction: column;
                                        justify-content: flex-end;
                                        position: absolute;
                                        top: -10px;
                                        left: 50%;
                                        transform: translateX(-50%) translateY(-100%);
                                        padding: 10px 15px;
                                        width: 270px;
                                        height: 270px;
                                        background: rgba(44, 44, 44, 0.8);
                                        z-index: 4;
                                        color: #fff;
                                        .setting-show-wrap {
                                            display: flex;
                                            align-items: center;
                                            .setting-show-area {
                                                position: relative;
                                                height: 100%;
                                                flex: 1;
                                                height: 5px;
                                                .setting-show-empty {
                                                    position: absolute;
                                                    left: var(--showArea, 25%);
                                                    top: 0;
                                                    height: 100%;
                                                    background-color: #474747;
                                                    width: calc(100% - var(--showArea, 75%));
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                                .setting-show-fill {
                                                    position: absolute;
                                                    left: 0;
                                                    bottom: 0;
                                                    height: 100%;
                                                    background-color: var(--brand-pink, #FF6699);
                                                    width: var(--showArea, 25%);
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                            }
                                        }
                                        .setting-opacity-wrap {
                                            display: flex;
                                            align-items: center;
                                            .setting-opacity-area {
                                                position: relative;
                                                height: 100%;
                                                flex: 1;
                                                height: 5px;
                                                .setting-opacity-empty {
                                                    position: absolute;
                                                    left: var(--opacity, 25%);
                                                    top: 0;
                                                    height: 100%;
                                                    background-color: #474747;
                                                    width: calc(100% - var(--opacity, 75%));
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                                .setting-opacity-fill {
                                                    position: absolute;
                                                    left: 0;
                                                    bottom: 0;
                                                    height: 100%;
                                                    background-color: var(--brand-pink, #FF6699);
                                                    width: var(--opacity, 25%);
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                            }
                                        }
                                        .setting-size-wrap {
                                            display: flex;
                                            align-items: center;
                                            .setting-size-area {
                                                position: relative;
                                                height: 100%;
                                                flex: 1;
                                                height: 5px;
                                                .setting-size-empty {
                                                    position: absolute;
                                                    left: var(--size, 25%);
                                                    top: 0;
                                                    height: 100%;
                                                    background-color: #474747;
                                                    width: calc(100% - var(--size, 75%));
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                                .setting-size-fill {
                                                    position: absolute;
                                                    left: 0;
                                                    bottom: 0;
                                                    height: 100%;
                                                    background-color: var(--brand-pink, #FF6699);
                                                    width: var(--size, 25%);
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                            }
                                        }
                                        .setting-speed-wrap {
                                            display: flex;
                                            align-items: center;
                                            .setting-speed-area {
                                                position: relative;
                                                height: 100%;
                                                flex: 1;
                                                height: 5px;
                                                .setting-speed-empty {
                                                    position: absolute;
                                                    left: var(--speed, 25%);
                                                    top: 0;
                                                    height: 100%;
                                                    background-color: #474747;
                                                    width: calc(100% - var(--speed, 25%));
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                                .setting-speed-fill {
                                                    position: absolute;
                                                    left: 0;
                                                    bottom: 0;
                                                    height: 100%;
                                                    background-color: var(--brand-pink, #FF6699);
                                                    width: var(--speed, 75%);
                                                    z-index: 1;
                                                    border-radius: 5px;
                                                }
                                            }
                                        }
                                        .progress-val {
                                            width: 30px;
                                        }
                                        .danmaku-setting-slider {
                                            appearance: none;
                                            position: absolute;
                                            left: 50%;
                                            bottom: 50%;
                                            width: 100%;
                                            height: 100%;
                                            transform: translateX(-50%) translateY(50%);
                                            transform-origin: 50% 50%;
                                            outline: none;
                                            background-color: transparent;
                                            border-radius: 5px;
                                            z-index: 2;
                                            &::-webkit-slider-thumb {
                                                appearance: none;
                                                width: 15px;
                                                height: 15px;
                                                border-radius: 50%;
                                                background-color: #fff;
                                                cursor: pointer;
                                            }
                                        }
                                        .danmaku-setting-step {
                                            background-image: radial-gradient(circle, #fff 0%, #fff 7%, transparent 0%);
                                            background-size: 25%; /* 每25%的宽度出现一个圆点 */
                                            background-position: -15% 0;
                                            background-repeat: repeat-x; /* 水平方向重复 */
                                        }
                                    }
                                }
                            }
                        }
                        .player-control-bottom-right {
                            .player-ctrl-quality {
                                position: relative;
                                font-size: 12px;
                                width: auto;
                                .player-ctrl-quality-menu {
                                    position: absolute;
                                    left: 50%;
                                    bottom: 50px;
                                    transform: translateX(-50%);
                                    background: hsla(0, 0%, 8%, .9);
                                    border-radius: 2px;
                                    overflow: hidden;
                                    padding: 5px;
                                    .player-ctrl-quality-item {
                                        position: relative;
                                        height: 36px;
                                        line-height: 36px;
                                        white-space: nowrap;
                                        padding: 0 12px;
                                        cursor: pointer;
                                        &:hover {
                                            background-color: hsla(0, 0%, 100%, .1);
                                            border-radius: 5px;
                                        }
                                    }
                                    .player-ctrl-quality-item-active {
                                        color: var(--brand-pink, #FF6699);
                                    }
                                }
                                .player-ctrl-quality-result {
                                    cursor: pointer;
                                    width: 100%;
                                }
                            }
                            .player-ctrl-playbackrate {
                                position: relative;
                                font-size: 12px;
                                width: 50px;
                                .player-ctrl-playbackrate-menu {
                                    position: absolute;
                                    left: 50%;
                                    bottom: 50px;
                                    transform: translateX(-50%);
                                    width: 62px;
                                    background: hsla(0, 0%, 8%, .9);
                                    border-radius: 2px;
                                    padding: 5px;
                                    .player-ctrl-playbackrate-item {
                                        position: relative;
                                        cursor: pointer;
                                        height: 36px;
                                        line-height: 36px;
                                        &:hover {
                                            background-color: hsla(0, 0%, 100%, .1);
                                            border-radius: 5px;
                                        }
                                    }
                                    .player-ctrl-playbackrate-item-active {
                                        color: var(--brand-pink, #FF6699);
                                    }
                                }
                                .player-ctrl-playbackrate-result {
                                    cursor: pointer;
                                    width: 100%;
                                }
                            }
                            .player-ctrl-volume {
                                position: relative;
                                &:hover {
                                    margin-top: -15px;
                                    padding-top: 15px;
                                }
                                .player-ctrl-volume-box {
                                    position: absolute;
                                    left: 50%;
                                    bottom: 50px;
                                    transform: translateX(-50%);
                                    height: 120px;
                                    width: 42px;
                                    background: hsla(0, 0%, 8%, .9);
                                    border-radius: 2px;
                                    .player-ctrl-volume-box-area {
                                        position: relative;
                                        width: 100%;
                                        height: 100%;
                                        .player-ctrl-volume-box-wrap {
                                            position: absolute;
                                            left: 50%;
                                            bottom: 50%;
                                            transform: translateX(-50%) translateY(50%);
                                            width: 2px;
                                            height: 80px;
                                            .volume-slider {
                                                appearance: none;
                                                position: absolute;
                                                left: 50%;
                                                bottom: 50%;
                                                width: 80px;
                                                height: 2px;
                                                transform: translateX(-50%) translateY(50%) rotate(-90deg);
                                                transform-origin: 50% 50%;
                                                outline: none;
                                                background-color: transparent;
                                                z-index: 2;
                                                border-radius: 5px;
                                                // 滑块样式
                                                &::-webkit-slider-thumb {
                                                    appearance: none;
                                                    width: 12px;
                                                    height: 12px;
                                                    border-radius: 50%;
                                                    background-color: var(--brand-pink, #FF6699);
                                                    cursor: pointer;
                                                }
                                            }
                                            .volume-fill {
                                                position: absolute;
                                                left: 0;
                                                bottom: 0;
                                                width: 100%;
                                                background-color: var(--brand-pink, #FF6699);
                                                height: var(--volume, 50%);
                                                z-index: 1;
                                                border-radius: 5px;
                                            }
                                            .volume-empty {
                                                position: absolute;
                                                left: 0;
                                                top: 0;
                                                width: 100%;
                                                background-color: #e7e7e7;
                                                height: calc(100% - var(--volume, 50%));
                                                z-index: 1;
                                                border-radius: 5px;
                                            }
                                        }
                                    }
                                    .player-ctrl-volume-number {
                                        text-align: center;
                                        color: #e5e9ef;
                                        font-size: 12px;
                                        height: 28px;
                                        line-height: 28px;
                                        margin-bottom: 2px;
                                        width: 100%;
                                    }
                                }
                            }
                        }
                        .opacity-fade-enter-active, .opacity-fade-leave-active {
                            transition: opacity 0.2s;
                        }
                        .opacity-fade-enter-from, .opacity-fade-leave-to {
                            opacity: 0;
                        }
                    }
                }
                .player-control-disvisiable-wrap {
                    position: absolute;
                    bottom: 0;
                    width: 100%;
                    .player-control-top {
                        position: absolute;
                        bottom: 0;
                        box-sizing: border-box;
                        width: 100%;
                        .player-process {
                            position: relative;
                            height: $processBarHeight;
                            width: 100%;
                            box-sizing: border-box;
                            border-radius: 999px;
                            overflow: hidden;
                        }
                        .player-process-main {
                            position: absolute;
                            left: 0;
                            top: 0;
                            z-index: 1;
                            width: 100%;
                            height: 100%;
                            background-color: hsla(0, 0%, 100%, .2)
                        }
                        .player-process-current {
                            position: absolute;
                            left: 0;
                            top: 0;
                            z-index: 3;
                            width: 0%;
                            height: 100%;
                            background-color: var(--brand-pink);
                            transition: .2s;
                            max-width: 100%;
                        }
                        .player-process-buffer {
                            position: absolute;
                            left: 0;
                            top: 0;
                            z-index: 2;
                            width: 0%;
                            height: 100%;
                            background-color: hsla(0, 0%, 100%, .3);
                            transition: .2s;
                            max-width: 100%;
                        }
                    }
                }
                .player-state-wrap {
                    bottom: 62px;
                    cursor: pointer;
                    pointer-events: none;
                    position: absolute;
                    right: 34px;
                    z-index: 1;
                    .player-pause-btn {
                        width: 68px;
                        height: 68px;
                        .img {
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
                .player-hide-introduce-btn {
                    position: absolute;
                    right: 0;
                    top: 50%;
                    cursor: pointer;
                    width: 30px;
                    height: 50px;
                    background-color: hsla(0, 0%, 8%, .5);
                    z-index: 2;
                    &:hover {
                        background-color: hsla(0, 0%, 8%, .8);
                    }
                    .img {
                        width: 20px;
                        height: 20px;
                    }
                }
            }
            .player-video-danmuku {
                position: absolute;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: 1;
            }
        }
    }
</style>